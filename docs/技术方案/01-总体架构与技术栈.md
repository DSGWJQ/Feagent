# æ€»ä½“æ¶æ„ä¸æŠ€æœ¯æ ˆ

> **æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£**
> é¡¹ç›®åç§°ï¼šFeagent
> æ–‡æ¡£è¯´æ˜ï¼šæœ¬æ–‡æ¡£æè¿°é¡¹ç›®çš„æ•´ä½“æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹

---

## ğŸ“ æ¶æ„è®¾è®¡åŸåˆ™

### æ ¸å¿ƒåŸåˆ™
1. **é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰**ï¼šä¸šåŠ¡é€»è¾‘ä¸æŠ€æœ¯å®ç°åˆ†ç¦»
2. **å…­è¾¹å½¢æ¶æ„ï¼ˆHexagonal Architectureï¼‰**ï¼šä¾èµ–å€’ç½®ï¼Œæ˜“æµ‹è¯•æ˜“æ›¿æ¢
3. **åˆ†å±‚æ¸…æ™°**ï¼šå››å±‚æ¶æ„ï¼Œä¾èµ–æ–¹å‘å•å‘
4. **æµ‹è¯•é©±åŠ¨ï¼ˆTDDï¼‰**ï¼šæµ‹è¯•å…ˆè¡Œï¼Œä¿è¯è´¨é‡
5. **æ¸è¿›å¼æ¼”è¿›**ï¼šå…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥å¢å¼º

### æ¶æ„å®šä½
- **è§„æ¨¡**ï¼šå•ä½“åº”ç”¨ï¼ˆMonolithicï¼‰ï¼Œå‰åç«¯åˆ†ç¦»
- **éƒ¨ç½²**ï¼šDocker Composeï¼ˆå¼€å‘/æµ‹è¯•/å°è§„æ¨¡ç”Ÿäº§ï¼‰
- **æ•°æ®åº“**ï¼šPostgreSQLï¼ˆç”Ÿäº§ï¼‰/ SQLiteï¼ˆå¼€å‘ï¼‰
- **å¯¹å¤–å®šä½**ï¼šä¼ä¸šçº§ç¨³å®šæ€§ä¸å¯ç”¨æ€§
- **å†…éƒ¨å®ç°**ï¼šæœ€å°å¤æ‚åº¦ä¼˜å…ˆï¼ŒæŒ‰éœ€æ¼”è¿›

---

## ğŸ—ï¸ å››å±‚æ¶æ„è¯¦è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Interface Layer (æ¥å£å±‚)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  FastAPI    â”‚  â”‚  React SPA   â”‚              â”‚
â”‚  â”‚  Routes     â”‚  â”‚  Components  â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ DTO (Pydantic)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application Layer (åº”ç”¨å±‚)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  UseCases: ç”¨ä¾‹ç¼–æ’ã€äº‹åŠ¡è¾¹ç•Œ             â”‚    â”‚
â”‚  â”‚  - CreateAgentUseCase                   â”‚    â”‚
â”‚  â”‚  - TriggerRunUseCase                    â”‚    â”‚
â”‚  â”‚  - ClassifyTaskUseCase (V2)             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Ports (Protocol/ABC)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Domain Layer (é¢†åŸŸå±‚)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Entities: Agent, Run, Task, Workflow   â”‚    â”‚
â”‚  â”‚  Value Objects: RunStatus, TaskType     â”‚    â”‚
â”‚  â”‚  Domain Services: å¤æ‚ä¸šåŠ¡é€»è¾‘           â”‚    â”‚
â”‚  â”‚  Ports: Repositoryã€LLMService æ¥å£      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              âŒ ç¦æ­¢å¯¼å…¥ä»»ä½•æ¡†æ¶                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ Adapters (å®ç°Ports)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Database    â”‚  â”‚  External Services  â”‚     â”‚
â”‚  â”‚  - ORMæ¨¡å‹   â”‚  â”‚  - LangChain        â”‚     â”‚
â”‚  â”‚  - Repositoryâ”‚  â”‚  - HTTP Client      â”‚     â”‚
â”‚  â”‚  - Alembic   â”‚  â”‚  - MCP Client (V4)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–è§„åˆ™ï¼ˆå¼ºåˆ¶ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¾èµ–æ–¹å‘ï¼ˆå•å‘ï¼‰                      â”‚
â”‚                                      â”‚
â”‚  Interface    â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                     â”‚                â”‚
â”‚  Application  â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â†’  Domain   â”‚
â”‚                     â”‚                â”‚
â”‚  Infrastructure â”€â”€â”€â”€â”˜                â”‚
â”‚                                      â”‚
â”‚  âŒ Domain ä¸ä¾èµ–ä»»ä½•å¤–å±‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¦æ­¢çš„ä¾èµ–**ï¼š
- âŒ Domain â†’ Application/Infrastructure/Interface
- âŒ Domain â†’ SQLAlchemy/FastAPI/LangChain
- âŒ Application â†’ Infrastructureï¼ˆåªèƒ½ä¾èµ–Portsï¼‰

---

## ğŸ’» åç«¯æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|---------|
| **Python** | 3.11+ | ç¼–ç¨‹è¯­è¨€ | å¼‚æ­¥æ”¯æŒã€ç±»å‹æç¤ºã€ç”Ÿæ€ä¸°å¯Œ |
| **FastAPI** | 0.104+ | Webæ¡†æ¶ | é«˜æ€§èƒ½ã€è‡ªåŠ¨APIæ–‡æ¡£ã€ç±»å‹å®‰å…¨ |
| **Pydantic** | v2.5+ | æ•°æ®æ ¡éªŒ | è¿è¡Œæ—¶æ ¡éªŒã€JSONåºåˆ—åŒ–ã€é…ç½®ç®¡ç† |
| **SQLAlchemy** | 2.0+ | ORM | æˆç†Ÿç¨³å®šã€2.0å¼‚æ­¥æ”¯æŒã€çµæ´» |
| **Alembic** | 1.13+ | æ•°æ®åº“è¿ç§» | SQLAlchemyå®˜æ–¹å·¥å…· |
| **PostgreSQL** | 14+ | æ•°æ®åº“ï¼ˆç”Ÿäº§ï¼‰ | äº‹åŠ¡æ”¯æŒã€JSONå­—æ®µã€é«˜å¯ç”¨ |
| **SQLite** | 3.37+ | æ•°æ®åº“ï¼ˆå¼€å‘ï¼‰ | é›¶é…ç½®ã€è½»é‡ã€å¿«é€Ÿè¿­ä»£ |

### AIä¸ç¼–æ’

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|---------|
| **LangChain** | 1.0+ | AIç¼–æ’æ¡†æ¶ | Agent/Chain/Toolsç”Ÿæ€å®Œå–„ |
| **OpenAI SDK** | 1.0+ | LLMè°ƒç”¨ | å®˜æ–¹SDKï¼ŒGPT-4æ”¯æŒ |
| **httpx** | 0.25+ | HTTPå®¢æˆ·ç«¯ | å¼‚æ­¥æ”¯æŒã€è¿æ¥æ±  |

### è¾…åŠ©å·¥å…·

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|---------|
| **structlog** | 23.1+ | ç»“æ„åŒ–æ—¥å¿— | JSONæ ¼å¼ã€trace_idæ”¯æŒ |
| **tenacity** | 8.2+ | é‡è¯•åº“ | æŒ‡æ•°é€€é¿ã€æ¡ä»¶é‡è¯• |
| **pytest** | 7.4+ | æµ‹è¯•æ¡†æ¶ | æ’ä»¶ä¸°å¯Œã€fixtureæœºåˆ¶ |
| **Ruff** | 0.1+ | Linter/Formatter | æé€Ÿã€ä¸€ä½“åŒ–å·¥å…· |
| **Pyright** | 1.1+ | ç±»å‹æ£€æŸ¥ | ä¸¥æ ¼ç±»å‹æ£€æŸ¥ |
| **uv** | 0.1+ | åŒ…ç®¡ç†å™¨ | å¿«é€Ÿã€å…¼å®¹pip |

---

## ğŸ¨ å‰ç«¯æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|---------|
| **React** | 18.3+ | UIæ¡†æ¶ | ç”Ÿæ€æˆç†Ÿã€æ€§èƒ½ä¼˜ç§€ |
| **TypeScript** | 5.9+ | ç±»å‹ç³»ç»Ÿ | ç±»å‹å®‰å…¨ã€å¼€å‘ä½“éªŒ |
| **Vite** | 5.x | æ„å»ºå·¥å…· | å¿«é€Ÿå¯åŠ¨ã€HMR |
| **Ant Design** | 5.x | UIç»„ä»¶åº“ | ä¼ä¸šçº§ã€ç»„ä»¶ä¸°å¯Œ |
| **XYFlow (React Flow)** | 11.x | æµç¨‹å›¾å¯è§†åŒ– | é«˜æ€§èƒ½ã€å¯æ‰©å±•ã€ç¤¾åŒºæ´»è·ƒ |

**XYFlow vs LogicFlow é€‰å‹è¯´æ˜**ï¼š
- **XYFlow**ï¼šReactç”Ÿæ€åŸç”Ÿã€TypeScriptæ”¯æŒå¥½ã€æ–‡æ¡£å®Œå–„
- **LogicFlow**ï¼šå›½äº§ã€ä¸­æ–‡æ–‡æ¡£ï¼Œä½†Reacté›†æˆç›¸å¯¹å¤æ‚
- **æœ€ç»ˆé€‰æ‹©**ï¼šXYFlowï¼ˆå·²åœ¨é¡¹ç›®ä¸­å®ç°ï¼‰

### çŠ¶æ€ç®¡ç†ä¸é€šä¿¡

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” | é€‰å‹ç†ç”± |
|------|------|------|---------|
| **TanStack Query** | 5.x | è¿œç¨‹çŠ¶æ€ç®¡ç† | ç¼“å­˜ã€è‡ªåŠ¨é‡è¯•ã€ä¹è§‚æ›´æ–° |
| **React Hooks** | - | æœ¬åœ°çŠ¶æ€ | ç®€å•å¤Ÿç”¨ï¼Œé¿å…è¿‡åº¦è®¾è®¡ |
| **EventSource** | åŸç”ŸAPI | SSEå®æ—¶é€šä¿¡ | æœåŠ¡å™¨æ¨é€ã€è‡ªåŠ¨é‡è¿ |
| **axios** | 1.6+ | HTTPå®¢æˆ·ç«¯ | æ‹¦æˆªå™¨ã€è¯·æ±‚å–æ¶ˆ |

### å¼€å‘å·¥å…·

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **ESLint** | 8.x | ä»£ç æ£€æŸ¥ |
| **Prettier** | 3.x | ä»£ç æ ¼å¼åŒ– |
| **Vitest** | 1.x | å•å…ƒæµ‹è¯• |

---

## ğŸ”„ æ•°æ®æµè½¬æœºåˆ¶

### è¯·æ±‚-å“åº”æµï¼ˆåŒæ­¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ â†’ åç«¯ï¼ˆåˆ›å»ºAgentï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. React Component
   â†“ (axios POST /agents)
2. FastAPI Route
   â†“ (DTO: CreateAgentRequest)
3. UseCase
   â†“ (Input: CreateAgentInput)
4. Domain Entity
   â†“ (Agent.create())
5. Repository.save()
   â†“ (ORM Model)
6. PostgreSQL
   â†“ (è¿”å›Entity)
7. UseCase
   â†“ (Response DTO)
8. FastAPI
   â†“ (JSON)
9. React Component (æ›´æ–°UI)
```

### SSEæµå¼æ¨é€ï¼ˆå¼‚æ­¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯ â†’ å‰ç«¯ï¼ˆæ‰§è¡ŒçŠ¶æ€å®æ—¶æ¨é€ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. å‰ç«¯: EventSourceè¿æ¥ /runs/{id}/stream
   â†“
2. FastAPI: è¿”å› text/event-stream
   â†“
3. RunExecutor: æ‰§è¡Œä»»åŠ¡
   â”œâ”€â†’ å‘é€äº‹ä»¶: task_started
   â”œâ”€â†’ å‘é€äº‹ä»¶: log (å®æ—¶æ—¥å¿—)
   â”œâ”€â†’ å‘é€äº‹ä»¶: task_completed
   â””â”€â†’ å‘é€äº‹ä»¶: done (ç»“æŸæ ‡å¿—)
   â†“
4. å‰ç«¯: ç›‘å¬messageäº‹ä»¶ï¼Œå®æ—¶æ›´æ–°UI
```

### å¯¹è±¡è½¬æ¢ï¼ˆAssembleræ¨¡å¼ï¼‰

```
Request DTO  â”€â”€â†’  Input  â”€â”€â†’  Entity  â”€â”€â†’  ORM  â”€â”€â†’  Database
    â†“                             â†“
Pydantic            Domain         SQLAlchemy
    â†“                             â†“
Response DTO â†â”€â”€  Entity  â†â”€â”€  ORM  â†â”€â”€  Database
```

**è½¬æ¢è§„åˆ™**ï¼š
- Interface â†’ Applicationï¼š`RequestDTO â†’ Input`
- Application â†’ Domainï¼š`Input â†’ Entity`
- Domain â†’ Infrastructureï¼š`Entity â†’ ORMModel`
- Infrastructure â†’ Domainï¼š`ORMModel â†’ Entity`
- Domain â†’ Interfaceï¼š`Entity â†’ ResponseDTO`

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡åŸåˆ™

### æ ¸å¿ƒè¡¨ç»“æ„

```sql
-- Agentï¼ˆä»£ç†é…ç½®ï¼‰
CREATE TABLE agents (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    start TEXT NOT NULL,
    goal TEXT NOT NULL,
    description TEXT,
    config JSONB,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP
);

-- Runï¼ˆæ‰§è¡Œå®ä¾‹ï¼‰
CREATE TABLE runs (
    id VARCHAR(36) PRIMARY KEY,
    agent_id VARCHAR(36) REFERENCES agents(id),
    status VARCHAR(20) NOT NULL,  -- PENDING/RUNNING/SUCCEEDED/FAILED
    input_data JSONB,
    result JSONB,
    error TEXT,
    started_at TIMESTAMP,
    finished_at TIMESTAMP,
    created_at TIMESTAMP NOT NULL
);

-- Taskï¼ˆä»»åŠ¡èŠ‚ç‚¹ï¼‰
CREATE TABLE tasks (
    id VARCHAR(36) PRIMARY KEY,
    run_id VARCHAR(36) REFERENCES runs(id),
    type VARCHAR(20) NOT NULL,  -- HTTP/LLM/JAVASCRIPT/PROMPT
    status VARCHAR(20) NOT NULL,
    input_data JSONB NOT NULL,
    output_data JSONB,
    error TEXT,
    started_at TIMESTAMP,
    finished_at TIMESTAMP,
    created_at TIMESTAMP NOT NULL
);

-- Workflowï¼ˆV2+ å·¥ä½œæµå®šä¹‰ï¼‰
CREATE TABLE workflows (
    id VARCHAR(36) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    nodes JSONB NOT NULL,  -- èŠ‚ç‚¹å®šä¹‰
    edges JSONB NOT NULL,  -- è¾¹å®šä¹‰
    config JSONB,
    created_at TIMESTAMP NOT NULL,
    updated_at TIMESTAMP
);
```

### è®¾è®¡åŸåˆ™
1. **IDç”Ÿæˆ**ï¼šUUID v4ï¼Œå…¨å±€å”¯ä¸€
2. **æ—¶é—´æˆ³**ï¼šç»Ÿä¸€ä½¿ç”¨UTCæ—¶é—´ï¼ŒISO 8601æ ¼å¼
3. **JSONå­—æ®µ**ï¼šä½¿ç”¨JSONBå­˜å‚¨åŠ¨æ€é…ç½®ï¼ˆPostgreSQLï¼‰
4. **å¤–é”®çº¦æŸ**ï¼šç¡®ä¿å¼•ç”¨å®Œæ•´æ€§
5. **ç´¢å¼•ç­–ç•¥**ï¼š
   - ä¸»é”®è‡ªåŠ¨ç´¢å¼•
   - å¤–é”®å­—æ®µå»ºç«‹ç´¢å¼•ï¼ˆagent_id, run_idï¼‰
   - çŠ¶æ€å­—æ®µå»ºç«‹ç´¢å¼•ï¼ˆstatusï¼‰
   - æ—¶é—´å­—æ®µå»ºç«‹ç´¢å¼•ï¼ˆcreated_atï¼‰

---

## ğŸ” å®‰å…¨ä¸é…ç½®

### ç¯å¢ƒå˜é‡ç®¡ç†

```bash
# .env.development
DATABASE_URL=sqlite:///./dev.db
OPENAI_API_KEY=sk-xxx
LOG_LEVEL=DEBUG
CORS_ORIGINS=["http://localhost:5173"]

# .env.production
DATABASE_URL=postgresql://user:pass@localhost:5432/feagent
OPENAI_API_KEY=${SECRET_OPENAI_KEY}  # ä»å¯†é’¥ç®¡ç†è¯»å–
LOG_LEVEL=INFO
CORS_ORIGINS=["https://app.example.com"]
```

### é…ç½®åŠ è½½ï¼ˆPydantic Settingsï¼‰

```python
# src/config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    app_name: str = "Feagent"
    app_version: str = "2.0.0"
    env: str = "development"

    database_url: str
    openai_api_key: str
    log_level: str = "INFO"
    cors_origins: list[str] = ["*"]

    class Config:
        env_file = ".env"
        env_file_encoding = "utf-8"

settings = Settings()
```

### å®‰å…¨è§„èŒƒ
1. **å¯†é’¥ç®¡ç†**ï¼šç¯å¢ƒå˜é‡æˆ–AWS Secrets Manager
2. **æ—¥å¿—è„±æ•**ï¼šæ•æ„Ÿå­—æ®µï¼ˆAPI Keyï¼‰ç”¨`***`æ›¿æ¢
3. **CORSé…ç½®**ï¼šç”Ÿäº§ç¯å¢ƒä¸¥æ ¼é™åˆ¶åŸŸå
4. **SQLæ³¨å…¥é˜²æŠ¤**ï¼šä½¿ç”¨ORMå‚æ•°åŒ–æŸ¥è¯¢
5. **é€Ÿç‡é™åˆ¶**ï¼šAPIé™æµï¼ˆå¯é€‰ï¼Œä½¿ç”¨slowapiï¼‰

---

## ğŸ“Š å¯è§‚æµ‹æ€§

### ç»“æ„åŒ–æ—¥å¿—

```python
# ä½¿ç”¨structlog
import structlog

logger = structlog.get_logger()

logger.info(
    "agent_created",
    agent_id=agent.id,
    agent_name=agent.name,
    trace_id=trace_id,
    user_id=user_id,
    elapsed_ms=123
)
```

**è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰**ï¼š
```json
{
  "event": "agent_created",
  "agent_id": "abc-123",
  "agent_name": "æµ‹è¯•Agent",
  "trace_id": "xyz-789",
  "user_id": "user-001",
  "elapsed_ms": 123,
  "timestamp": "2025-01-15T10:30:00Z",
  "level": "info"
}
```

### å¥åº·æ£€æŸ¥

```python
# src/interfaces/api/main.py
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "version": settings.app_version,
        "database": "connected"  # å¯æ£€æŸ¥DBè¿æ¥
    }
```

### æ ¸å¿ƒæŒ‡æ ‡ï¼ˆæœªæ¥ï¼‰
- æ‰§è¡Œæ•°é‡ï¼ˆæ€»æ•°ã€æˆåŠŸã€å¤±è´¥ï¼‰
- æ‰§è¡Œæ—¶é•¿ï¼ˆP50ã€P95ã€P99ï¼‰
- APIå“åº”æ—¶é—´
- SSEè¿æ¥æ•°

---

## ğŸ³ éƒ¨ç½²æ¶æ„

### Docker Composeï¼ˆå¼€å‘/å°è§„æ¨¡ç”Ÿäº§ï¼‰

```yaml
version: '3.8'

services:
  backend:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@db:5432/feagent
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    depends_on:
      - db

  frontend:
    build: ./web
    ports:
      - "5173:80"
    depends_on:
      - backend

  db:
    image: postgres:14
    environment:
      - POSTGRES_DB=feagent
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:
```

### æœªæ¥æ‰©å±•ï¼ˆä¼ä¸šçº§ï¼‰
- **Kubernetes**ï¼šæ°´å¹³æ‰©å±•ã€æ»šåŠ¨æ›´æ–°
- **Redis**ï¼šç¼“å­˜ã€ä»»åŠ¡é˜Ÿåˆ—
- **Nginx**ï¼šåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡
- **Prometheus + Grafana**ï¼šç›‘æ§å‘Šè­¦

---

## ğŸ”„ ç‰ˆæœ¬æ¼”è¿›ä¸æ¶æ„å˜åŒ–

| ç‰ˆæœ¬ | æ¶æ„å˜åŒ– | æ–°å¢æŠ€æœ¯ |
|------|---------|---------|
| **V1** | å››å±‚æ¶æ„åŸºç¡€ | FastAPI, SQLAlchemy, React |
| **V2** | å¼•å…¥FSMçŠ¶æ€æœº | LangChainåˆ†ç±»æ¨¡å‹ |
| **V3** | å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç† | ConversationBufferMemory |
| **V4** | MCPé›†æˆ | MCP Client/Server SDK |

---

## ğŸ“š æŠ€æœ¯é€‰å‹å¯¹æ¯”

### ä¸ºä»€ä¹ˆé€‰æ‹©FastAPIè€ŒéFlaskï¼Ÿ

| ç»´åº¦ | FastAPI | Flask |
|------|---------|-------|
| **æ€§èƒ½** | å¼‚æ­¥é«˜æ€§èƒ½ï¼ˆStarletteï¼‰ | åŒæ­¥ï¼Œè¾ƒæ…¢ |
| **ç±»å‹å®‰å…¨** | PydanticåŸç”Ÿæ”¯æŒ | éœ€æ‰‹åŠ¨æ ¡éªŒ |
| **APIæ–‡æ¡£** | è‡ªåŠ¨ç”ŸæˆOpenAPI | éœ€æ’ä»¶ |
| **å¼‚æ­¥æ”¯æŒ** | åŸç”Ÿasync/await | éœ€æ‰©å±• |

### ä¸ºä»€ä¹ˆé€‰æ‹©XYFlowè€ŒéLogicFlowï¼Ÿ

| ç»´åº¦ | XYFlow (React Flow) | LogicFlow |
|------|---------------------|-----------|
| **Reacté›†æˆ** | åŸç”ŸReactç»„ä»¶ | éœ€é€‚é…å±‚ |
| **TypeScript** | å®Œæ•´ç±»å‹å®šä¹‰ | éƒ¨åˆ†æ”¯æŒ |
| **æ–‡æ¡£** | è‹±æ–‡ï¼Œå®Œå–„ | ä¸­æ–‡ï¼Œè¾ƒå°‘ |
| **ç¤¾åŒº** | æ´»è·ƒï¼ˆGitHub 18k+ starsï¼‰ | å›½å†…ï¼ˆ3k+ starsï¼‰ |
| **æ€§èƒ½** | è™šæ‹ŸåŒ–æ¸²æŸ“ï¼Œå¤§å›¾ä¼˜åŒ– | ä¸­ç­‰ |

**ç»“è®º**ï¼šXYFlowæ›´é€‚åˆReactç”Ÿæ€ï¼Œå·²åœ¨é¡¹ç›®ä¸­å®ç°ï¼Œæ— éœ€æ›´æ¢ã€‚

---

## âš ï¸ æ¶æ„æ¼”è¿›æ³¨æ„äº‹é¡¹

### å½“å‰æ¶æ„é€‚ç”¨èŒƒå›´
âœ… **é€‚åˆ**ï¼š
- å•æœºéƒ¨ç½²ï¼ˆ<1000å¹¶å‘ï¼‰
- ä¸­å°è§„æ¨¡å·¥ä½œæµï¼ˆ<100èŠ‚ç‚¹ï¼‰
- å¼€å‘è¿­ä»£å¿«é€Ÿ

âŒ **ä¸é€‚åˆ**ï¼ˆéœ€å‡çº§æ¶æ„ï¼‰ï¼š
- é«˜å¹¶å‘ï¼ˆ>10000 QPSï¼‰
- åˆ†å¸ƒå¼è°ƒåº¦
- å¤šç§Ÿæˆ·éš”ç¦»

### å‡çº§è·¯å¾„
1. **Phase 1**ï¼ˆå½“å‰ï¼‰ï¼šå•ä½“ + SQLite/PostgreSQL
2. **Phase 2**ï¼šå¼•å…¥Redisç¼“å­˜ + ä»»åŠ¡é˜Ÿåˆ—
3. **Phase 3**ï¼šå¾®æœåŠ¡æ‹†åˆ†ï¼ˆAPI / Executor / Schedulerï¼‰
4. **Phase 4**ï¼šKubernetes + åˆ†å¸ƒå¼å­˜å‚¨

---

> **æ–‡æ¡£æ›´æ–°**ï¼š
> - æŠ€æœ¯æ ˆå‡çº§æ—¶åŠæ—¶æ›´æ–°ç‰ˆæœ¬å·
> - æ¶æ„è°ƒæ•´æ—¶æ›´æ–°ä¾èµ–å›¾
> - æ–°å¢å¤–éƒ¨é›†æˆæ—¶è¡¥å……é€‰å‹è¯´æ˜
