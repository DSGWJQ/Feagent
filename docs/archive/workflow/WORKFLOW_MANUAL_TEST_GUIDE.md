# 工作流编辑器手动测试指南

## 📋 测试前准备

### **1. 确保后端服务运行**

打开新的终端窗口，运行：

```bash
cd d:\My_Project\agent_data
python -m uvicorn src.interfaces.api.main:app --port 8000
```

看到以下输出表示成功：
```
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Application startup complete.
```

### **2. 确保前端服务运行**

打开新的终端窗口，运行：

```bash
cd d:\My_Project\agent_data\web
npm run dev
```

看到以下输出表示成功：
```
VITE v7.2.2  ready in 264 ms
➜  Local:   http://localhost:3000/
```

### **3. 创建测试工作流（如果还没有）**

```bash
cd d:\My_Project\agent_data
python scripts/create_test_workflow.py
```

记下输出的工作流 ID，例如：`wf_b8c85f1a`

---

## 🧪 测试场景

### **测试 1：页面加载**

**步骤**：
1. 打开浏览器
2. 访问：`http://localhost:3000/workflows/wf_b8c85f1a/edit`

**预期结果**：
- ✅ 页面正常加载，没有白屏
- ✅ 看到标题"工作流编辑器"
- ✅ 看到"保存"和"执行"按钮
- ✅ 看到 React Flow 画布
- ✅ 画布上有 3 个节点：
  - 节点 1：Start（左侧）
  - 节点 2：HTTP Request（中间）
  - 节点 3：End（右侧）
- ✅ 节点之间有连线

**如果失败**：
- 打开浏览器开发者工具（F12）
- 查看 Console 标签页是否有错误
- 查看 Network 标签页是否有 API 请求失败

---

### **测试 2：拖拽节点**

**步骤**：
1. 鼠标点击"HTTP Request"节点
2. 按住鼠标左键拖动节点
3. 移动到新位置后松开鼠标

**预期结果**：
- ✅ 节点跟随鼠标移动
- ✅ 连线自动调整
- ✅ 松开鼠标后节点停留在新位置

---

### **测试 3：保存工作流**

**步骤**：
1. 拖动节点到新位置
2. 点击"保存"按钮

**预期结果**：
- ✅ 按钮显示"加载中"状态
- ✅ 1-2 秒后显示成功提示："工作流保存成功"
- ✅ 按钮恢复正常状态

**验证**：
1. 刷新页面（F5）
2. 节点应该保持在新位置（说明保存成功）

**如果失败**：
- 打开浏览器开发者工具（F12）
- 查看 Network 标签页
- 找到 `PATCH /api/workflows/wf_b8c85f1a` 请求
- 查看请求状态码和响应内容

---

### **测试 4：执行工作流（非流式）**

**步骤**：
1. 打开浏览器开发者工具（F12）
2. 切换到 Network 标签页
3. 点击"执行"按钮

**预期结果**：
- ✅ 按钮显示"加载中"状态
- ✅ Network 标签页出现 `POST /api/workflows/wf_b8c85f1a/execute/stream` 请求
- ✅ 右侧出现"执行日志"面板
- ✅ 面板中显示"正在执行节点: xxx"
- ✅ 执行完成后显示执行日志：
  ```
  start (node_xxx)
  http (node_xxx)
  end (node_xxx)
  ```
- ✅ 节点颜色变化：
  - 运行中：蓝色
  - 完成：绿色
  - 错误：红色

**如果失败**：
- 查看 Network 标签页的请求详情
- 查看 Console 标签页是否有错误
- 查看后端终端是否有错误日志

---

### **测试 5：连接节点**

**步骤**：
1. 鼠标悬停在"Start"节点上
2. 看到节点边缘出现小圆点（连接点）
3. 点击并拖动连接点
4. 拖动到"End"节点上
5. 松开鼠标

**预期结果**：
- ✅ 拖动时出现连线预览
- ✅ 松开鼠标后创建新连线
- ✅ 新连线连接"Start"和"End"节点

---

### **测试 6：删除连线**

**步骤**：
1. 点击选中一条连线
2. 按 Delete 键或 Backspace 键

**预期结果**：
- ✅ 连线被删除

---

### **测试 7：删除节点**

**步骤**：
1. 点击选中一个节点
2. 按 Delete 键或 Backspace 键

**预期结果**：
- ✅ 节点被删除
- ✅ 连接到该节点的所有连线也被删除

---

## 🐛 常见问题排查

### **问题 1：页面白屏**

**可能原因**：
- 前端服务未启动
- 路由配置错误
- React 组件渲染错误

**排查步骤**：
1. 检查前端服务是否运行：`http://localhost:3000`
2. 打开浏览器开发者工具（F12）
3. 查看 Console 标签页的错误信息
4. 查看 Network 标签页是否有 404 错误

---

### **问题 2：节点不显示**

**可能原因**：
- 后端 API 未返回节点数据
- 数据格式不匹配
- React Flow 初始化失败

**排查步骤**：
1. 打开浏览器开发者工具（F12）
2. 查看 Network 标签页
3. 找到 `GET /api/workflows/wf_b8c85f1a` 请求
4. 查看响应数据是否包含 `nodes` 和 `edges` 字段
5. 查看 Console 标签页是否有错误

---

### **问题 3：保存失败**

**可能原因**：
- 后端服务未启动
- 数据格式错误
- 数据库写入失败

**排查步骤**：
1. 检查后端服务是否运行
2. 打开浏览器开发者工具（F12）
3. 查看 Network 标签页的 `PATCH` 请求
4. 查看请求状态码：
   - 200：成功
   - 400：请求数据格式错误
   - 404：工作流不存在
   - 500：服务器错误
5. 查看后端终端的错误日志

---

### **问题 4：执行失败**

**可能原因**：
- 后端服务未启动
- 工作流包含环
- 节点执行逻辑错误

**排查步骤**：
1. 检查后端服务是否运行
2. 打开浏览器开发者工具（F12）
3. 查看 Network 标签页的 `POST` 请求
4. 查看响应数据是否包含错误信息
5. 查看后端终端的错误日志

---

### **问题 5：SSE 流式执行无响应**

**可能原因**：
- SSE 连接失败
- 事件解析错误
- 后端未发送事件

**排查步骤**：
1. 打开浏览器开发者工具（F12）
2. 查看 Network 标签页的 `execute/stream` 请求
3. 查看请求类型是否为 `eventsource` 或 `fetch`
4. 查看响应头是否包含 `Content-Type: text/event-stream`
5. 查看响应数据是否包含 `data: {...}` 格式的事件
6. 查看 Console 标签页是否有解析错误

---

## 📊 测试结果记录

### **测试环境**
- 操作系统：Windows
- 浏览器：Chrome / Edge / Firefox
- 前端服务：http://localhost:3000
- 后端服务：http://127.0.0.1:8000

### **测试结果**

| 测试场景 | 状态 | 备注 |
|---------|------|------|
| 测试 1：页面加载 | ⏳ 待测试 | |
| 测试 2：拖拽节点 | ⏳ 待测试 | |
| 测试 3：保存工作流 | ⏳ 待测试 | |
| 测试 4：执行工作流 | ⏳ 待测试 | |
| 测试 5：连接节点 | ⏳ 待测试 | |
| 测试 6：删除连线 | ⏳ 待测试 | |
| 测试 7：删除节点 | ⏳ 待测试 | |

---

## 📝 测试反馈

请在测试完成后填写以下信息：

### **成功的功能**
- [ ] 页面加载
- [ ] 拖拽节点
- [ ] 保存工作流
- [ ] 执行工作流
- [ ] 连接节点
- [ ] 删除连线
- [ ] 删除节点

### **失败的功能**
- [ ] 页面加载（错误信息：___）
- [ ] 拖拽节点（错误信息：___）
- [ ] 保存工作流（错误信息：___）
- [ ] 执行工作流（错误信息：___）
- [ ] 连接节点（错误信息：___）
- [ ] 删除连线（错误信息：___）
- [ ] 删除节点（错误信息：___）

### **其他问题**
- 

---

## 🎯 下一步

根据测试结果：
1. 如果所有测试通过 → 继续实现高级功能（节点配置面板、自定义节点等）
2. 如果有测试失败 → 修复 Bug，重新测试
3. 如果有新需求 → 记录到需求列表，优先级排序

