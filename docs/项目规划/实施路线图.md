# Feagent 实施路线图

> **项目规划文档**
> 项目名称：Feagent
> 文档说明：本文档描述项目的分阶段实施计划和里程碑

---

## 🎯 总体规划

### 项目愿景
成为Coze平台的"粘合剂"，为个人开发者和入门用户提供低门槛、高可视化的工作流构建与执行平台。

### 核心里程碑

```
Phase 1: 核心能力      Phase 2: 智能增强      Phase 3: 生态扩展      Phase 4: 自主演进
  (V1)                  (V2)                  (V3)                  (V4)
   ↓                     ↓                     ↓                     ↓
基础执行引擎   →    智能任务识别    →    对话式Agent    →    MCP自循环Agent
SSE流式输出          FSM状态机            COS介入模式           自我规划执行
工作流可视化          工具管理             多轮对话              MCP集成
                    Coze导入             上下文管理            工具市场
```

---

## 📅 Phase 1: 核心能力（V1）

### 时间线：2024 Q4 ✅ 已完成

### 核心功能
1. **Agent基础执行**
   - 输入：起点（start）+ 目标（goal）
   - 自动生成线性任务计划（3-7步）
   - 依次执行任务节点
   - SSE实时推送执行状态

2. **四层架构实现**
   - Domain层：Agent, Run, Task实体
   - Application层：CreateAgentUseCase, TriggerRunUseCase
   - Infrastructure层：SQLAlchemy Repository
   - Interface层：FastAPI REST API

3. **前端可视化**
   - React + TypeScript + Vite
   - Ant Design UI组件库
   - XYFlow工作流画布
   - SSE实时日志查看器

4. **节点执行器**
   - HTTP节点（GET/POST请求）
   - LLM节点（OpenAI调用）
   - JAVASCRIPT节点（代码执行）
   - PROMPT节点（文本处理）

### 验收标准
- [x] POST /agents 创建Agent成功
- [x] POST /agents/{id}/runs 触发Run成功
- [x] GET /agents/{id}/runs/{run_id}/stream SSE流式输出
- [x] 前端工作流画布拖拽编辑
- [x] 测试覆盖率：Domain≥80%, Application≥70%
- [x] 端到端Demo：GitHub Trending → 钉钉推送

### 技术栈确定
- 后端：Python 3.11, FastAPI, SQLAlchemy 2.0, PostgreSQL
- 前端：React 18, TypeScript 5, XYFlow, Ant Design
- 编排：LangChain 1.0+
- 部署：Docker Compose

---

## 📅 Phase 2: 智能增强（V2）

### 时间线：2025 Q1-Q2 🔄 进行中

### 核心功能

#### 1. 智能任务识别
- **任务分类器**：LLM自动识别任务类型
  - SIMPLE：单次操作（如API调用）
  - WORKFLOW：多步骤流程
  - CHAT：需要对话澄清

- **FSM状态机**：更细粒度的状态管理
  ```
  PENDING → CLASSIFYING → PLANNING → EXECUTING → COMPLETED
                       ↓
                   NEED_CLARIFICATION → (用户补充) → PLANNING
  ```

- **验收标准**：
  - [ ] 实现ClassifyTaskUseCase
  - [ ] 集成LangChain分类模型
  - [ ] 分类准确率≥85%

#### 2. Coze工作流导入
- **JSON解析**：解析Coze导出的工作流格式
- **节点映射**：Coze节点类型 → Feagent节点类型
- **自动布局**：Dagre算法计算节点位置
- **验收标准**：
  - [ ] Workflow实体与Repository
  - [ ] POST /workflows/import/coze API
  - [ ] 前端上传与可视化
  - [ ] 导入成功率≥95%

#### 3. 工具生命周期管理
- **工具注册**：创建、测试、发布工具
- **工具版本**：语义化版本管理
- **工具市场**：预定义工具库
- **验收标准**：
  - [ ] Tool实体与Repository
  - [ ] 工具执行器框架
  - [ ] 5+预定义工具（HTTP, LLM, DB, File, Notify）

#### 4. 多LLM提供商支持
- **提供商管理**：OpenAI, DeepSeek, Qwen, Anthropic
- **统一接口**：LLMClient抽象层
- **成本跟踪**：Token使用统计
- **验收标准**：
  - [ ] LLMProvider实体
  - [ ] 至少3个提供商集成
  - [ ] 成本计算与展示

#### 5. 前端增强
- **节点面板**：拖拽添加节点
- **配置面板**：双击编辑节点属性
- **自动布局**：一键整理画布
- **执行监控**：实时高亮当前节点
- **验收标准**：
  - [ ] NodePalette组件
  - [ ] NodeConfigPanel组件
  - [ ] 自动布局算法
  - [ ] 执行动画效果

### 技术债务清理
- [ ] 重构NodeExecutor为Plugin架构
- [ ] 统一错误处理机制
- [ ] 添加API限流
- [ ] 优化数据库索引

### 里程碑：V2.0发布
- 时间：2025年6月
- 目标：支持Coze导入、智能任务识别、多LLM提供商

---

## 📅 Phase 3: 生态扩展（V3）

### 时间线：2025 Q3-Q4

### 核心功能

#### 1. 对话式Agent（COS模式）
- **持续介入**：执行过程中用户可随时介入
- **主动澄清**：Agent主动提问获取信息
- **对话上下文**：ChatSession实体管理对话历史
- **验收标准**：
  - [ ] ChatSession实体与Repository
  - [ ] 多轮对话SSE事件扩展
  - [ ] 主动澄清机制（3+场景）
  - [ ] 用户介入操作（暂停/恢复/修改）

#### 2. 子工作流与复用
- **子工作流节点**：调用另一个工作流
- **工作流模板**：保存为模板复用
- **参数化**：工作流输入输出参数定义
- **验收标准**：
  - [ ] SUBWORKFLOW节点类型
  - [ ] WorkflowTemplate实体
  - [ ] 模板市场基础框架

#### 3. 高级节点类型
- **CONDITION节点**：条件分支执行
- **LOOP节点**：循环执行批量任务
- **PARALLEL节点**：并行执行多个分支
- **验收标准**：
  - [ ] 实现3种高级节点
  - [ ] DAG调度器支持
  - [ ] 前端可视化支持

#### 4. Coze双向集成
- **工具调用**：Feagent调用Coze工具API
- **能力暴露**：通过MCP暴露Feagent能力
- **数据同步**：Coze ↔ Feagent变更同步（实验）
- **验收标准**：
  - [ ] CozeClient实现
  - [ ] 调用Coze工具成功
  - [ ] MCP Server基础框架

#### 5. 权限与多租户基础
- **用户系统**：基础认证与鉴权
- **工作流权限**：私有/公开/协作
- **资源隔离**：多用户数据隔离
- **验收标准**：
  - [ ] User实体与认证
  - [ ] 工作流访问控制
  - [ ] 数据隔离测试通过

### 技术升级
- [ ] 引入Redis缓存
- [ ] 异步任务队列（Celery）
- [ ] 数据库主从复制（可选）
- [ ] Prometheus监控（可选）

### 里程碑：V3.0发布
- 时间：2025年12月
- 目标：对话式Agent、高级节点、Coze双向集成

---

## 📅 Phase 4: 自主演进（V4）

### 时间线：2026 Q1-Q2

### 核心功能

#### 1. MCP驱动的自循环Agent
- **MCP集成**：Client调用外部工具，Server暴露能力
- **ReAct模式**：规划-执行-观察-反思-决策循环
- **自我修复**：执行失败时自动调整策略
- **预算控制**：Token/成本/时间预算早停
- **验收标准**：
  - [ ] MCP Client集成
  - [ ] MCP Server实现
  - [ ] ReAct自循环逻辑
  - [ ] 预算与早停机制
  - [ ] 自我修复案例验证（3+场景）

#### 2. 工具市场
- **发现与搜索**：按关键词/分类/评分搜索工具
- **一键安装**：远程安装工具到本地
- **评价系统**：用户评价与评分
- **验收标准**：
  - [ ] ToolMarketplace API
  - [ ] 前端工具市场页面
  - [ ] 评价系统
  - [ ] 100+预定义工具

#### 3. AI辅助编排
- **智能推荐**：根据上下文推荐下一步节点
- **自动布局**：AI优化节点位置
- **执行回放**：时间轴回放执行过程
- **验收标准**：
  - [ ] 节点推荐算法
  - [ ] AI辅助布局
  - [ ] 执行回放UI

#### 4. 协作与版本控制
- **多人协作**：实时协同编辑工作流
- **版本历史**：工作流快照与回滚
- **评论系统**：节点上添加注释
- **验收标准**：
  - [ ] WebSocket协作
  - [ ] WorkflowVersion实体
  - [ ] 评论系统

### 技术架构升级
- [ ] 微服务拆分（API / Executor / Scheduler）
- [ ] Kubernetes部署
- [ ] 分布式存储（MinIO）
- [ ] 消息队列（RabbitMQ/Kafka）

### 里程碑：V4.0发布
- 时间：2026年6月
- 目标：MCP自循环Agent、工具市场、AI辅助编排

---

## 📊 关键指标（KPI）

### 技术指标

| 指标 | V1目标 | V2目标 | V3目标 | V4目标 |
|------|--------|--------|--------|--------|
| **工作流执行成功率** | 90% | 93% | 95% | 97% |
| **平均执行时间** | <30s | <25s | <20s | <15s |
| **测试覆盖率（Domain）** | 80% | 85% | 85% | 90% |
| **API响应时间（P95）** | <500ms | <400ms | <300ms | <200ms |
| **并发支持** | 10 | 50 | 200 | 1000 |

### 业务指标

| 指标 | V1目标 | V2目标 | V3目标 | V4目标 |
|------|--------|--------|--------|--------|
| **月活跃用户** | 50 | 200 | 500 | 1000 |
| **人均工作流数** | 1 | 3 | 5 | 10 |
| **Coze导入使用率** | - | 20% | 30% | 40% |
| **工具市场工具数** | 10 | 50 | 200 | 500 |
| **用户满意度（NPS）** | - | 30 | 50 | 60 |

---

## 🔄 迭代策略

### 每个Phase的开发节奏
```
Week 1-2: 需求确认 + 技术调研
Week 3-4: Domain层设计 + TDD测试
Week 5-6: Infrastructure + Application层
Week 7-8: Interface层（API + 前端）
Week 9: 集成测试 + Bug修复
Week 10: 文档更新 + 发布准备
```

### 发布策略
- **Alpha版本**：内部测试，核心功能验证
- **Beta版本**：小范围用户测试，收集反馈
- **RC版本**：候选发布，稳定性验证
- **正式版本**：公开发布，文档齐全

### 回顾与调整
- **每月回顾**：进度、问题、风险
- **季度规划调整**：根据反馈调整优先级
- **年度总结**：复盘全年，规划下一年

---

## 🎯 成功标准

### Phase 1（V1）成功标准 ✅
- [x] 核心执行流程打通
- [x] SSE实时推送功能正常
- [x] 前端可视化基础完成
- [x] 至少1个端到端Demo成功

### Phase 2（V2）成功标准
- [ ] Coze工作流导入成功率≥95%
- [ ] 任务分类准确率≥85%
- [ ] 至少3个LLM提供商集成
- [ ] 前端体验显著提升（用户反馈）

### Phase 3（V3）成功标准
- [ ] 对话式Agent 3+使用场景
- [ ] 高级节点（条件/循环/并行）可用
- [ ] 月活用户≥500
- [ ] 工作流模板库≥50个

### Phase 4（V4）成功标准
- [ ] MCP自循环成功案例≥10个
- [ ] 工具市场工具≥200个
- [ ] 月活用户≥1000
- [ ] NPS≥60

---

## 📋 待办清单（当前阶段：V2）

### 高优先级（本月）
- [ ] 实现ClassifyTaskUseCase
- [ ] Workflow实体与Repository
- [ ] Coze JSON导入API
- [ ] 前端节点面板（NodePalette）

### 中优先级（下月）
- [ ] Tool实体与Repository
- [ ] 工具执行器框架
- [ ] LLMProvider管理
- [ ] 成本跟踪功能

### 低优先级（Q2）
- [ ] 自动布局算法优化
- [ ] 节点配置面板
- [ ] API限流
- [ ] 监控告警

---

> **文档更新**：
> - 每个Phase完成后更新验收标准
> - 每月更新待办清单和进度
> - KPI未达标时分析原因并调整
