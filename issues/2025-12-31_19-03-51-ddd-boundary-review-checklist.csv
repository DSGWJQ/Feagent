id,priority,phase,area,title,description,acceptance_criteria,test_mcp,review_initial_requirements,review_regression_requirements,dev_state,review_initial_state,review_regression_state,git_state,owner,refs,notes
DDD-010,P0,0,both,落地 Port/Adapter 契约与位置规范,将 Port/Adapter/Composition Root 规则固化为可执行的代码结构：ports 仅协议与 domain 数据结构，adapters 在 infrastructure，组装仅在 interfaces/api/main.py。,"`src/domain/ports/` 下包含清单列出的关键 Port（至少 `capability_definition_source.py`, `execution_event_sink.py`, `idempotency_store.py`）；`rg -n ""sqlalchemy|fastapi|requests|yaml"" src/domain/ports/` 无匹配；routes/dependencies 不 new adapters/registries；项目既有服务端测试命令（如 `pytest -q`）通过。",AUTOSERVER,Port 只暴露 Protocol/ABC 与 domain 级类型；禁止把 DTO/ORM model 泄漏到 Domain；DI 仅在 `src/interfaces/api/main.py`，且明确生命周期/资源释放（DB session、连接等）。,复跑边界检查（文档中的 `rg`/`lint-imports`）；执行单测与关键集成测试；确认启动流程与依赖注入不引入循环依赖。,已完成,已完成,已完成,已提交,,docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:62;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:524;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:526;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:546;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:568,"picked_reason:P0 基础边界规范先落地，后续 issues 依赖其约束;validation_limited:pytest/compileall 写入 .pytest_cache/__pycache__/删除 .coverage 均遇 WinError 5;manual_test:rg -n \\""sqlalchemy|fastapi|requests|yaml\""\"" src/domain/ports/ && rg -n \""\""\\bSQLAlchemy\\w+\\(\""\"" src/interfaces/api/routes src/interfaces/api/dependencies && python -c \""\""from src.interfaces.api.main import app; print(app.title)\""\"";evidence:rg 检查 ports 无越界依赖且 routes/dependencies 无 SQLAlchemy 直接构造；FastAPI app 可 import;risk:high 未完成全量 pytest 回归;done_at:2025-12-31"""
DDD-020,P0,1,both,统一 Workflow 执行入口到 Orchestrator,让 REST `/api/workflows/{id}/execute` 与其它入口统一走 Application Orchestrator；Interface 层只做参数解析与依赖注入，避免绕过治理与策略链。,`src/interfaces/api/routes/workflows.py` 不再导入 Domain Agent/Service；`src/interfaces/api/main.py` 作为 composition root 负责实例化 repo/registry 并注入 orchestrator；执行文档中的 Interface/Application 边界 `rg` 检查无匹配；新增或更新 integration test 覆盖 execute 端点确实走 orchestrator + policy chain。,AUTOE2E,先消除越界 import 再调整调用链；接口响应/错误映射保持兼容；新增依赖通过 Ports/Protocols 注入，避免在 route 中实例化具体实现。,复跑边界 `rg` + 服务端测试（`pytest`/integration）；对 `/api/workflows/{id}/execute` 做回归（成功/失败/权限/参数非法）。,已完成,已完成,已完成,已提交,,docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:111;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:113;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:121;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:132;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:616,"picked_reason:P0 将执行入口统一到 Orchestrator，避免绕过策略链;evidence:pytest -q -o addopts= tests/integration/api/workflows/test_execute_uses_orchestrator.py 通过;validation_limited:AUTOE2E/全量回归未跑（pyproject addopts 含 --cov 且 .coverage/.pytest_cache 写入受 WinError 5 影响）;manual_test:python -c \\""from src.interfaces.api.main import app; print(app.title)\""\"";risk:medium;done_at:2025-12-31"""
DDD-030,P0,2,backend,消除重复 DAG 逻辑并引入唯一 WorkflowEngine,将拓扑排序/节点执行语义收敛到 Domain `WorkflowEngine`；WorkflowAgent/WorkflowExecutor 变薄或被替代，避免“双真相来源”。,DAG 执行主逻辑只保留一个权威实现（其他路径仅委托/适配）；允许迁移窗口：Domain 内 YAML/Path 仅允许出现在明确 allowlist 文件（其余保持 0）；缺 executor 时不做 mock fallback（抛出明确 domain error）；新增 unit tests 覆盖拓扑排序与缺 executor 错误分支。,AUTOSERVER,WorkflowEngine 只依赖 Ports（registry/event sink 等）；禁止在 Domain 引入 IO/解析；错误/异常类型统一走 domain exceptions，避免 silent fallback。,跑全量服务端测试与关键集成用例；对同一 workflow 的执行结果做回归对比（包含条件/循环/失败节点）。,进行中,进行中,未开始,未提交,,docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:162;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:164;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:185;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:367;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:444,blocked:acceptance 涉及 src/domain/** 全量清除 yaml/pathlib import；当前存在 yaml_import_lines=11 path_import_lines=16，需拆分/定义迁移窗口与允许清单;next:先收敛到 node/tool definitions 与 workflow_dependency_graph 等高频入口，再逐步搬迁到 src/infrastructure/definitions/*;risk:high 涉及 Domain 大范围移动/拆分，易引入回归;unblocked_by:allowlist_confirmed;allowlist_scope:仅保留 node/tool definitions 解析相关 legacy 模块，逐步收敛
DDD-040,P0,3,both,Capabilities 单一事实来源与启动校验,把 Capability 定义加载（YAML/DB/其他）放到 Infrastructure，通过 `CapabilityDefinitionSource` Port 提供给 Application Catalog；启动时对“定义→执行器”完整性 fail fast。,capabilities=nodes；YAML 目录=definitions/nodes；schema=definitions/schemas/node_definition_schema.json；YAML 加载位于 src/infrastructure/definitions/*；Application 通过 CapabilityDefinitionSource 列表加载 definitions；启动时对 definitions 做 fail-fast 校验（字段缺失/无效 executor_type/解析失败均报错且包含 file:line 或 file path）；新增测试覆盖：缺失/无效 executor_type 时启动校验失败；正常场景可加载全部 definitions。,AUTOSERVER,定义数据结构与 Port 的职责边界清晰（Domain 不感知来源）；启动校验错误信息可定位到具体 definition/type；避免把解析细节泄漏到 Domain。,复跑 capabilities 相关 integration tests；验证启动性能与错误路径（缺文件/坏 YAML/缺 executor）均可预测且可观测。,已完成,已完成,已完成,已提交,,docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:204;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:206;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:213;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:223;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:638;src/infrastructure/definitions/yaml_node_definition_source.py:1;src/application/services/capability_catalog_service.py:1;src/interfaces/api/main.py:1;tests/unit/application/services/test_capability_catalog_service.py:1;definitions/nodes/data_analysis_parent.yaml:19,blocked:Capabilities Catalog/启动校验需要新增 Infra 定义加载 + Application Catalog 组合；当前定义/YAML 解析散落于 Domain services，需先明确“capability”的定义域与数据源;next:确定 capabilities=tools? nodes? 并明确 YAML 目录与 schema，然后再落地 CapabilityDefinitionSource 实现与启动 fail-fast;risk:high 涉及启动路径与定义加载，缺乏现有 catalog 基础;unblocked_by:capabilities_nodes_confirmed;done_at:2026-01-02;evidence:pytest -q -o addopts= tests/unit/application/services/test_capability_catalog_service.py;evidence:startup loads 20 definitions via YamlNodeDefinitionSource;validation_limited:AUTOSERVER 全量未跑（仅跑 focused unit test；.pytest_cache 有 WinError 5 警告）;manual_test:pytest -q -o addopts= tests/unit/application/services/test_capability_catalog_service.py;risk:medium 启动时增加 YAML 加载与校验，definitions/nodes 变更可能导致 fail-fast
DDD-050,P0,4,both,让 Coordinator 成为唯一对话入口（ConversationTurnOrchestrator）,conversation_stream 路由只依赖 Application Orchestrator；移除 Interface 直连 Domain Agent 的注入方式，确保治理/策略不可绕过。,`src/interfaces/**` 中 `from src.domain.agents...` 出现次数 = 0（执行文档的 Interface `rg` 检查无匹配）；路由改为依赖 `ConversationTurnOrchestrator`/UseCase（而非直接拿 Domain Agent）；新增或更新 streaming 相关 E2E/integration test 验证请求链路确实走 orchestrator + policy。,AUTOE2E,确保对话入口只有一个（无“第二入口”）；依赖注入只从 app.state 取已组装对象；对 SSE/streaming 的资源释放与异常处理做防御性检查。,回归对话 streaming：正常输出、异常中断、取消、并发请求；复跑边界检查与服务端测试。,已完成,已完成,已完成,已提交,,docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:247;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:249;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:256;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:270;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:335;src/interfaces/api/routes/conversation_stream.py:26;src/interfaces/api/dependencies/agents.py:17;src/interfaces/api/routes/coordinator_status.py:21;src/interfaces/api/routes/agent_websocket.py:37;src/interfaces/api/main.py:283;src/application/services/conversation_turn_orchestrator.py:1;src/interfaces/api/routes/conversation_stream.py:1,"picked_reason:P0 优先消除 Interface→Domain Agent 直连绕过点;done_at:2025-12-31;evidence:rg src/interfaces no src.domain.agents matches;evidence:pytest -q -o addopts= tests/integration/api/conversation/test_stream_uses_orchestrator.py;validation_limited:AUTOE2E 未配置/未执行，仅执行 integration pytest（且 .pytest_cache 有 WinError 5 警告）;manual_test:pytest -q -o addopts= tests/integration/api/conversation/test_stream_uses_orchestrator.py; rg -n ""^from\s+src\.domain\.agents"" src/interfaces -S;risk:medium 新增挂载 /api/conversation/stream，运行时依赖 LLM/配置可能导致返回 error 事件"
DDD-060,P0,5,backend,并发/幂等/一致性加固（Ports + 测试）,在 Application 层实现并发编排（标准库）与幂等控制（IdempotencyStore Port），补齐一致性回归测试，并禁止测试/脚本绕过 Application 入口。,Application 不直接依赖具体 broker/redis client（通过 Port 注入，禁止在 Application `import` 具体实现）；幂等 key 重复请求返回一致结果（integration/E2E 测试覆盖）；测试代码不再从 Interface 直连 Domain Agent 执行工作流（执行文档中相关检查/Review 点通过）。,AUTOE2E,并发使用标准库并明确取消/超时策略；幂等存储的读写与错误处理可观测（日志/trace）；避免在测试中“为方便”绕过 orchestrator。,压测/并发回归（至少覆盖多请求同时执行）；复跑所有 integration tests；故障注入（幂等存储不可用、重复提交）行为符合预期。,已完成,已完成,已完成,已提交,,docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:291;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:300;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:313;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:320;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:605;src/domain/ports/idempotency_store.py:1;src/application/services/workflow_execution_orchestrator.py:1;src/interfaces/api/routes/workflows.py:1;src/application/services/idempotency_coordinator.py:1;src/infrastructure/adapters/in_memory_idempotency_store.py:1;tests/integration/api/workflows/test_execute_idempotency.py:1,picked_reason:P0 先补齐幂等/并发治理，降低重复请求与回归风险;done_at:2025-12-31;evidence:pytest -q -o addopts= tests/integration/api/workflows/test_execute_idempotency.py;evidence:Idempotency-Key duplicate returns cached result (execute called once);validation_limited:AUTOE2E/压测/故障注入未执行（仅跑 focused integration pytest；.pytest_cache 有 WinError 5 警告）;manual_test:pytest -q -o addopts= tests/integration/api/workflows/test_execute_idempotency.py;risk:medium 新增 Idempotency-Key 行为与内存幂等存储（进程内有效），需评估多进程部署一致性
DDD-070,P1,6,both,建立并启用 DDD 边界自动化门禁,把清单中的边界检查固化为可重复执行的自动化：import-linter 合同 + 快速 `rg` 检查，并把 Code Review Checklist 作为 PR 流程门禁与回归标准。,新增 `.import-linter.toml`（含 Interface/Application/Domain 三条 forbidden 合同）且 `lint-imports` 通过；文档中的 `rg` 快速检查在 CI/本地可一键运行并在目标分支无匹配；PR/CI 中包含该门禁步骤，失败时输出可定位到文件/行。,AUTOSERVER,在启用严格门禁前，明确迁移窗口与已知违例清零策略；避免 false positive（仅约束模块边界，不约束 test helpers 的合理例外需显式说明）。,"干净工作区重复运行 `lint-imports` + `rg` + `pytest`；检查文档（`docs/architecture/*`, `CLAUDE.md`）与代码一致，且不引入循环依赖。",已完成,已完成,已完成,已提交,,docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:602;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:616;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:650;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:654;docs/architecture/DDD_BOUNDARY_REVIEW_CHECKLIST.md:685;pyproject.toml:1;.github/workflows/ci.yml:1;.import-linter.toml:1;scripts/ddd_boundary_checks.py:1,"picked_reason:P1 先落地边界门禁以降低后续 P0 重构回归风险;done_at:2025-12-31;evidence:python scripts/ddd_boundary_checks.py (OK);validation_limited:本机未安装 import-linter 且 network_access=restricted，未执行 lint-imports（CI 会安装并执行）;manual_test:uv venv && uv pip install -e "".[dev]"" && lint-imports && python scripts/ddd_boundary_checks.py;risk:low 仅新增门禁配置/脚本与 CI step，不改运行时代码"
