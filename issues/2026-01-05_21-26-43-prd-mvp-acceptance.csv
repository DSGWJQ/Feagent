id,priority,phase,area,title,description,acceptance_criteria,test_mcp,review_initial_requirements,review_regression_requirements,dev_state,review_initial_state,review_regression_state,git_state,owner,refs,notes
PRD-010,P1,1,both,冻结验收合同与基线（1–2 天）,冻结 PRD MVP 的验收合同与基线回归命令，形成可持续的可回归证据链。,pytest: `pytest -q tests/integration/api/workflow_chat/test_chat_create_stream_api.py` 通过; pytest: 错误分级 unit tests 通过; frontend: `pnpm -C web test` 通过; 输出一份可勾选 Checklist（引用 plan）,AUTOE2E,Review 关注：验收点是否可测试/可复现；refs 是否精确到 file:line；避免新增无关范围。,回归要求：跑后端关键测试 + 前端 vitest；确认 SSE 合同字段未破坏（含 metadata.workflow_id / node_error 字段）。,已完成,已完成,已完成,已提交,,plan/2026-01-05_21-16-50-prd-mvp-acceptance.md:106; src/interfaces/api/routes/workflows.py:563; src/interfaces/api/routes/workflows.py:427; web/src/features/workflows/components/AgentTimeline.tsx:176,picked_reason:基线命令可复用且可解阻塞后续验收; done_at:2026-01-05; evidence:pytest -q tests/integration/api/workflow_chat/test_chat_create_stream_api.py; evidence:pytest -q tests/unit/infrastructure/executors/test_tool_node_executor.py; evidence:pytest -q tests/integration/api/test_workflow_execution_error_classification.py; evidence:pnpm -C web test; summary:更新 Phase 1 checklist + 固化基线回归命令
PRD-020,P0,2,backend,主连通子图“双层防御”落地（P0，2–4 天）,实现“只改 start→end 主连通子图”的双层防御：prompt 裁剪 + 落地拒绝。,新增/更新 unit tests 覆盖：缺 start/end→空集；无路径→空集；孤立节点/子图被排除; chat prompt workflow_state 只包含主连通子图; LLM 返回子图外 node_id/edge_id 修改时被 fail-closed 拒绝（返回结构化错误）,AUTOSERVER,Review 关注：纯函数/无副作用；Fail-Closed（拒绝而非静默跳过）；不破坏现有 chat-stream 事件协议。,回归要求：跑 `pytest -q tests/unit/domain/services/test_workflow_chat_service_enhanced.py` 及相关集成；确认孤立节点在 UI 中不被修改。,已完成,已完成,已完成,已提交,,plan/2026-01-05_21-16-50-prd-mvp-acceptance.md:115; src/domain/services/workflow_chat_service_enhanced.py:32; src/domain/services/workflow_chat_service_enhanced.py:546; src/interfaces/api/routes/workflows.py:814,picked_reason:P0 backend 且 refs 精确，优先交付可测点; done_at:2026-01-05; evidence:pytest -q tests/unit/domain/services/test_workflow_chat_service_enhanced.py; summary:prompt 裁剪到主连通子图 + 子图外 id 修改 fail-closed 拒绝; commit_retry:pre-commit hook failed (pyright); commit_retry_fixed:pyright
PRD-030,P0,3,both,外部副作用 confirm 协议（P0，2–5 天）,落地外部副作用 confirm 协议：执行前阻断并要求用户确认，确认后才继续执行。,"执行链路出现外部副作用时产生 confirm_required（或等价）事件并暂停; 前端弹窗 allow/deny 可操作且结果可观测（Timeline/Coordinator stream 可见）; 未确认前不执行副作用节点，确认后继续同一 run 执行;  side_effect_scope: tool/httpRequest/database/file/notification; confirm_event: {type=confirm_required, run_id, workflow_id, node_id, default_decision=deny, confirm_id}; confirm_api: POST /api/runs/{run_id}/confirm {confirm_id, decision=allow|deny} 同一 run 继续/终止",AUTOE2E,Review 关注：KISS（最小状态机）；安全优先（默认 deny/需确认）；日志/事件字段不泄露敏感信息。,回归要求：端到端走一遍“需确认→确认→继续执行”；断线/取消时状态不乱；Coordinator stream 事件可解析。,已完成,已完成,已完成,已提交,,plan/2026-01-05_21-16-50-prd-mvp-acceptance.md:123; src/interfaces/api/routes/workflows.py:427; src/interfaces/api/routes/coordinator_status.py:160; web/src/features/workflows/components/AgentTimeline.tsx:176,picked_reason:P0 协议缺失先落盘阻塞点; decision:default_A; unblocked_at:2026-01-05; done_at:2026-01-05; evidence:pytest -q tests/unit/application/services/test_workflow_run_execution_entry_confirm_gate.py; evidence:pnpm -C web test; validation_limited:no real server SSE e2e; manual_test:run backend then execute workflow with http/tool node; expect modal and POST /api/runs/{run_id}/confirm; risk:low confirm gate has unit coverage
PRD-040,P0,4,both,失败→ReAct 自动修正闭环接线（P0，3–7 天）,补齐“失败→ReAct 自动修正→再次 RUN”的闭环主链路，并落地停止条件。,可复现失败（如 tool_not_found/timeout）后进入修正循环并产生可解释事件流; 停止条件生效：最大6轮/连续失败3轮/10分钟/20次LLM调用，触发时输出终止报告（可下载）; 同一 run_id/correlation_id 可追踪（RunEvents/Timeline 一致）;  patch_scope: config-only（不增删节点/边）；termination_report: RunEvents 事件（可下载）,AUTOE2E,Review 关注：闭环链路是否同源事实源（run_id）；错误分级是否贯穿；避免把业务逻辑塞进路由层。,回归要求：至少 2 个故障注入场景（tool_not_found、retryable timeout）；确认终止报告字段齐全且可回放。,进行中,进行中,未开始,未提交,,plan/2026-01-05_21-16-50-prd-mvp-acceptance.md:132; src/interfaces/api/routes/workflows.py:427; src/interfaces/api/routes/runs.py:100; web/src/features/workflows/components/AgentTimeline.tsx:176,picked_reason:P0 闭环涉及多子系统需先明确合同; decision:default_A; unblocked_at:2026-01-05
PRD-050,P1,5,frontend,变更预览（diff/preview）可读化（P1，1–3 天）,把 workflow 预览从“pendingWorkflow”升级为可读 diff/变更摘要，并保证容错。,展示节点/边 add/delete/update 计数与关键字段差异; 未知字段不崩溃（容错）；确认同步后画布与摘要一致; 新增 Vitest 覆盖 diff 计算与渲染;  diff_baseline: 当前画布 state（canvas 为 master）,AUTOFRONTEND,Review 关注：UI 信息密度与可读性；不阻塞主流程；保持组件职责单一。,回归要求：chat-create 与 chat-stream 两种来源都能产生 diff；大 workflow 下性能可接受（不明显卡顿）。,进行中,进行中,未开始,未提交,,plan/2026-01-05_21-16-50-prd-mvp-acceptance.md:140; web/src/features/workflows/components/NodePalette.tsx:101; web/src/features/workflows/components/AgentTimeline.tsx:176,picked_reason:P1 需先确认 diff 基线来源; decision:default_A; unblocked_at:2026-01-05
PRD-060,P1,6,both,指标验证基准（6/10）测试化（P1，2–5 天）,将 PRD 指标（10 次 run ≥ 6 次无需人工排查）转换为可重复的 scenario 基准。,定义 10 条固定 scenario（含输入/期望/允许降级）；离线可重复运行（mock LLM/确定性 tools）；可选真实 LLM 回归（带 OPENAI_API_KEY 时启用，默认可 skip）并输出成功统计;  scenarios: offline-first（mock LLM + deterministic tools），real LLM regression optional when key present; success_metric: >=6/10 auto-judged,AUTOE2E,Review 关注：可重复性优先；避免 flaky；scenario 覆盖典型失败类型与修正路径。,回归要求：每次里程碑跑一遍 scenario；对比 RunEvents 输出结构不漂移；记录失败原因分类。,进行中,进行中,未开始,未提交,,plan/2026-01-05_21-16-50-prd-mvp-acceptance.md:147; src/interfaces/api/routes/runs.py:100; web/src/features/workflows/components/AgentTimeline.tsx:176,picked_reason:P1 需要明确 10 条可复现 scenario; decision:default_A; unblocked_at:2026-01-05
PRD-070,P1,7,backend,补齐 execute/stream 错误分级集成测试基架（P1，0.5–1 天）,修复 execute/stream 错误分级集成测试基架，确保 SSE 契约可回归。,使用 FastAPI dependency_overrides 正确替换 get_container/get_db_session 等依赖; `tests/integration/api/test_workflow_execution_error_classification.py` 稳定通过并真实验证 SSE payload 字段; Import-Csv/解析不依赖真实 DB workflow 存在,AUTOSERVER,Review 关注：测试不应依赖外部状态；只验证契约；失败信息可读。,回归要求：在 CI/本机多次运行稳定；与 unit 分类逻辑一致（error_level/error_type/retryable/hint/message）。,已完成,已完成,已完成,已提交,,plan/2026-01-05_21-16-50-prd-mvp-acceptance.md:155; tests/integration/api/test_workflow_execution_error_classification.py:28; src/interfaces/api/routes/workflows.py:427,picked_reason:P1 backend 且可通过单文件集成测试闭环; done_at:2026-01-05; evidence:pytest -q tests/integration/api/test_workflow_execution_error_classification.py; summary:dependency_overrides 覆盖依赖 + mock stream 支持 kwargs + 契约字段回归
PRD-080,P2,8,both,发布前检查清单（0.5–1 天）,发布前检查清单：测试/边界合同/必要文档最小更新，确保交付可控。,后端 pytest 关键用例通过；前端 vitest 关键用例通过；import-linter 通过; SSE 合同未破坏（execute/stream 仅 node_*/workflow_*）；仅更新必要文档（API/协议），不新增无关文档,AUTOE2E,Review 关注：变更范围最小化；回滚路径明确；配置/feature flags 有文档对齐。,回归要求：完整跑一遍关键命令集并保存日志；手工点验 1 次 end-to-end（创建→修改→run→下载事件）。,已完成,已完成,已完成,已提交,,plan/2026-01-05_21-16-50-prd-mvp-acceptance.md:170; src/interfaces/api/routes/workflows.py:563; src/interfaces/api/routes/workflows.py:427; src/interfaces/api/routes/runs.py:100; src/interfaces/api/routes/coordinator_status.py:160,picked_reason:将关键命令集与回滚路径固化为发布前 gate; done_at:2026-01-05; evidence:pytest -q tests/integration/api/workflow_chat/test_chat_create_stream_api.py; evidence:pytest -q tests/integration/api/test_workflow_execution_error_classification.py; evidence:pytest -q tests/unit/infrastructure/executors/test_tool_node_executor.py; evidence:PYTHONUTF8=1 lint-imports --config .import-linter.toml; evidence:pnpm -C web test; summary:补齐 Phase 8 发布前 checklist
