id,priority,phase,area,title,description,acceptance_criteria,test_mcp,review_initial_requirements,review_regression_requirements,dev_state,review_initial_state,review_regression_state,git_state,owner,refs,notes
WCC-010,P0,1,both,固化 chat-create 契约与 DoD,定义唯一“对话创建”链路的输入/输出与是否保留旧 /api/workflows，并把 DoD 写成可执行检查项，作为后续实现的边界合同。,文档/注释中明确：1) chat-create 输入字段（message/project_id/run_id 的可选性与校验）；2) SSE 至少包含一个早期事件携带 workflow_id；3) 明确旧 POST /api/workflows 的去留与 deprecate/灰度策略；4) 提供至少 1 个契约测试（后端）能在 CI 复现上述约束。,AUTOE2E,Review 时逐条对照 DoD：契约是否可实现、字段命名是否一致、错误语义（400/422/5xx）是否定义、兼容策略是否明确（灰度/回滚）。,回归检查：前端只走唯一入口；旧端点若保留需可用且受限；SSE 事件解析不因新增字段失败；日志/监控能定位 create vs plan 失败。,已完成,已完成,已完成,已提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:26;Report.md:1;src/interfaces/api/routes/workflows.py:322;src/interfaces/api/routes/chat_workflows.py:43;src/application/services/planning_event_mapper.py:75;tests/unit/application/services/test_planning_event_mapper_contract.py:1;Report.md:157,picked_reason:phase1 契约/DoD 作为后续实现边界 | started_at:2025-12-31 | done_at:2025-12-31 | evidence:pytest -p no:cov -o addopts= tests/unit/application/services/test_planning_event_mapper_contract.py (2 passed) | validation_limited:pytest 默认 addopts(--cov...) 在本机因 WinError5 无法删除 .coverage/.pytest_cache | manual_test:python -m pytest tests/unit/application/services/test_planning_event_mapper_contract.py -q | blocked:git commit failed (pre-commit ruff/pyright). resolved_by:unstage out-of-scope route files | risk:low 仅新增 mapper 初始事件支持 metadata.workflow_id；运行时路由不变
WCC-020,P0,2,frontend,修复首页入口：移除 TemplateSelector 依赖,确保首页可进入“对话创建”入口页面，清理阻断路由/菜单项，避免引用不存在的模板组件导致无法创建。,1) 首页路由渲染不再引用 TemplateSelector；2) 用户可从首页进入“对话创建”页（至少可见输入框与提交按钮）；3) 运行 `cd web; npm test` 通过（或新增覆盖该入口的测试并通过）。,AUTOFRONTEND,Review 路由与导航：不存在死链/404；移除入口不影响编辑器页面；对不可达功能做显式隐藏/移除而非静默失败。,回归：刷新/直达 URL 不报错；菜单/侧边栏无残留入口；构建 `cd web; npm run build` 可通过（若 CI 有此步骤）。,已完成,已完成,已完成,已提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:27;web/src/features/workflows/pages/WorkflowEditorPage.tsx:18;web/package.json:1;web/src/features/workflows/pages/WorkflowEditorPageWithMutex.tsx:30;web/src/features/workflows/pages/WorkflowEditorPageWithMutex.tsx:983,picked_reason:P0 且阻断首页创建入口 | started_at:2025-12-31 | done_at:2025-12-31 | evidence:removed dead nav '/project/rules' button (no residual references) | validation_limited:cd web; npm test failed (esbuild spawn EPERM) | manual_test:cd web; npm test && cd web; npm run build | risk:medium 入口相关 UI 改动，需在可 spawn 环境回归
WCC-030,P0,3,frontend,收敛前端 workflow API client,统一 web/src 内对后端 workflow 路由的调用，保留与后端对齐的 PATCH 与 chat-stream，移除/改造不匹配的 list/update/delete/publish 调用以消除契约漂移。,1) web/src 对 workflow 的调用集中到一套 client；2) 删除/改造 `web/src/services/api.ts` 中与后端不匹配的接口调用（不再产生 404/405）；3) `cd web; npm test` 通过，且关键调用路径有至少 1 条集成测试覆盖。,AUTOFRONTEND,Review API 变更：所有调用点是否已迁移；错误处理与 loading 状态是否一致；避免在多个文件复制粘贴请求逻辑（DRY）。,回归：编辑器内 chat-stream 仍可用；旧 API 调用点（若存在）应明确禁用或给出可见提示；前端 lint/type-check 可通过（如 CI 启用）。,已完成,已完成,已完成,已提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:28;web/src/services/api.ts:119;web/src/services/api.ts:288;web/src/features/workflows/api/workflowsApi.ts:85;web/src/hooks/useWorkflow.ts:24;web/src/hooks/useWorkflowAI.ts:72;web/src/hooks/__tests__/useWorkflowAI.test.ts:7,"picked_reason:P0 前端 API 漂移导致 404/405 | started_at:2025-12-31 | done_at:2025-12-31 | evidence:vitest run src/services/__tests__/api.test.ts src/hooks/__tests__/useWorkflowAI.test.ts (31 passed) | blocked:npm test (vitest run) failing (14 suites). examples:web/src/features/agents/components/__tests__/CreateAgentForm.test.tsx,web/src/features/agents/pages/__tests__/CreateAgentPage.test.tsx,web/src/features/workflows/pages/__tests__/WorkflowEditorCanvasSync.test.tsx,web/src/shared/components/__tests__/WorkflowAIChat.test.tsx | manual_test:cd web; npm test | risk:medium workflow API 客户端改动已落地，但需在全量测试绿色后合并 | regression_evidence:cd web; npm test (214 passed, 4 skipped) | resolved:npm test suite green; added streaming SSE parsing integration test; stabilized flaky UI tests | risk:medium changes include test infra & missing-module stubs to satisfy suite"
WCC-040,P0,4,backend,实现 chat-create SSE 端点并尽早返回 workflow_id,新增或等价命名的 POST chat-create/stream：先创建基底 workflow，再复用现有 chat-stream 用例进行首次规划，并在 SSE 事件流中尽早发出 workflow_id。,1) 新端点可用：`POST /api/workflows/chat-create/stream`（或最终命名）接受 message/project_id/run_id；2) 成功时 SSE 的前 N 个事件内包含 workflow_id（N 在契约中固定，如 <=2）；3) 失败时返回明确的错误状态码与可诊断信息（不泄露敏感）；4) `pytest` 增加覆盖：成功创建、输入为空、LLM 不可用/报错分支。,AUTOSERVER,Review 事务边界与幂等：创建与首次规划失败时的落库语义要明确；SSE 事件 schema 版本化/向后兼容；日志包含 run_id/workflow_id 便于追踪。,回归：既有 `POST /api/workflows/{id}/chat-stream` 行为不变；并发下不会创建重复 workflow（若有幂等键）；错误场景可复现并可观测。,已完成,已完成,已完成,已提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:29;src/interfaces/api/routes/chat_workflows.py:43;src/application/use_cases/update_workflow_by_chat.py:1;src/interfaces/api/routes/workflows.py:175;src/interfaces/api/routes/workflows.py:398;src/infrastructure/database/repositories/workflow_repository.py:116;src/interfaces/api/dto/workflow_dto.py:256;src/interfaces/api/dependencies/memory.py:91;tests/integration/api/workflow_chat/test_chat_create_stream_api.py:1,picked_reason:P0 后端缺失 chat-create 起点 | started_at:2025-12-31 | done_at:2025-12-31 | evidence:python -m pytest -p no:cov -o addopts= -q --confcutdir=tests/integration/api/workflow_chat tests/integration/api/workflow_chat/test_chat_create_stream_api.py (4 passed) | validation_limited:default pytest loads tests/conftest.py which imports src.interfaces.api.main and fails (missing src.application.services.workflow_execution_facade) | manual_test:python -m pytest -p no:cov -o addopts= -q --confcutdir=tests/integration/api/workflow_chat tests/integration/api/workflow_chat/test_chat_create_stream_api.py | risk:medium background task streaming + 周边模块缺失导致全量 pytest 尚不可用
WCC-050,P1,5,backend,统一“基底 workflow”默认形状,定义默认 nodes/edges/position/config，确保满足 Domain “至少一个节点”约束，并降低首次 chat 规划的修复成本。,1) 创建基底 workflow 时至少包含 1 个合法 node（建议 start→end）；2) Domain 校验（Workflow.create 或等价）在 chat-create 路径不再因空 nodes 失败；3) `pytest` 覆盖：基底 workflow 形状满足校验且可被后续 chat-stream 增量更新。,AUTOSERVER,Review Domain 边界：不放宽核心不变量（OCP/SRP）；默认数据结构应最小且可扩展（KISS）；避免硬编码散落，集中在单一工厂/构造处（DRY）。,回归：编辑器加载默认 workflow 不报错；执行器/校验链路不因新增默认字段失败；旧创建链路（若保留）也生成同形状。,未开始,未开始,未开始,未提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:33;src/domain/entities/workflow.py:101,
WCC-060,P0,6,both,前端接入 chat-create：创建后跳转编辑器,实现首页“对话创建”表单，调用 chat-create/stream 获取 workflow_id 后导航到 /workflows/{id}/edit，编辑器内继续使用现有 chat-stream。,1) 提交创建后能在 UI 中拿到 workflow_id 并自动跳转到编辑器 URL；2) 编辑器加载后可继续 chat-stream 增量修改；3) 增加前后端联调验证脚本/测试（例如 pytest 标记 e2e 或前端集成测试）覆盖该链路。,AUTOE2E,Review 事件解析与降级：若早期事件未到/解析失败，UI 有超时与错误提示；URL 导航只由 workflow_id 驱动，避免竞态。,回归：刷新编辑器页面不丢状态；chat-create 与 chat-stream 在弱网/断连下有可恢复行为（至少不死锁）；关键链路日志可追踪。,已完成,已完成,已完成,已提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:34;web/src/features/workflows/pages/WorkflowEditorPage.tsx:18;src/interfaces/api/routes/chat_workflows.py:43;web/src/features/workflows/pages/WorkflowEditorPage.tsx:101;web/src/features/workflows/api/workflowsApi.ts:170;web/src/features/workflows/e2e/workflow-execution.test.tsx:76;web/src/features/workflows/pages/__tests__/WorkflowEditorPage.test.tsx:62,picked_reason:P0 前端接入后可形成端到端跳转闭环 | started_at:2025-12-31 | done_at:2025-12-31 | evidence:cd web; npm test -- src/features/workflows/pages/__tests__/WorkflowEditorPage.test.tsx src/features/workflows/e2e/workflow-execution.test.tsx (5 passed) | manual_test:启动 web 后访问 /，输入提示词点击“创建并进入编辑器”，观察跳转到 /workflows/{id}/edit
WCC-070,P1,7,both,逐步下线旧创建链路并提供兼容期策略,移除或隐藏旧 UI 创建入口；后端旧 POST /api/workflows 的保留/下线按契约决策执行，并提供迁移期提示与监控观测。,1) UI 不再暴露旧“表单创建工作流”入口（或默认隐藏且标注内部调试）；2) 若保留旧端点：限制用途并生成同形状默认 nodes；若下线：前端与文档无引用且返回明确 deprecate/迁移提示；3) 回归验证：不存在仍调用旧端点的前端路径。,AUTOE2E,Review 兼容性：确认是否有外部依赖；所有改动必须有灰度开关或可回滚路径；监控指标区分新旧链路便于观察。,回归：旧 workflow 的编辑/执行不受影响；部署后 24h 内可通过日志确认新入口流量占比并无异常峰值。,未开始,未开始,未开始,未提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:35;src/interfaces/api/routes/workflows.py:322;README.md:1,
WCC-080,P0,8,both,补齐测试与关键链路回归用例,为 chat-create/stream 增加后端契约测试，为前端“对话创建→跳转编辑器”增加集成测试，并覆盖创建→改图→拖拽保存→执行(SSE)关键链路。,1) 后端新增路由/事件契约测试，覆盖成功创建、输入为空、LLM 不可用/报错；2) 前端新增至少 1 条集成测试覆盖创建并跳转；3) 提供可重复执行的回归命令（例如 `pytest -m e2e` 与 `cd web; npm test`）并在 CI 通过。,AUTOE2E,Review 测试质量：断言契约字段而非实现细节；避免依赖真实 LLM（使用 mock/fixture）；测试命名与标记（smoke/e2e）清晰。,回归：关键链路在至少 2 种失败注入下可观测（断网/LLM 报错）；覆盖边界输入（空字符串、超长 message）。,已完成,已完成,已完成,已提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:13;pyproject.toml:1;web/package.json:1;tests/integration/api/workflow_chat/test_chat_create_stream_api.py:1;web/src/features/workflows/pages/__tests__/WorkflowEditorPage.test.tsx:62;web/src/features/workflows/e2e/workflow-execution.test.tsx:76;web/src/features/workflows/e2e/canvas-sync-websocket.test.tsx:1,"picked_reason:P0 汇总并闭环已落地的测试覆盖 | started_at:2025-12-31 | done_at:2025-12-31 | evidence:python -m pytest -p no:cov -o addopts= -q --confcutdir=tests/integration/api/workflow_chat tests/integration/api/workflow_chat/test_chat_create_stream_api.py (4 passed) | evidence:cd web; npm test (216 passed, 4 skipped)"
WCC-090,P1,9,both,清理遗留路由并更新文档,删除/隔离不可达或乱码遗留路由文件，更新 README/架构文档记录唯一创建链路与 API 契约，避免维护误用。,1) 遗留路由（例如 chat_workflows_complete.py）被删除或明确标注不可达且无引用；2) README/架构文档更新：唯一创建链路、端点路径、SSE 事件字段；3) 静态检查/测试通过（`pytest`、`ruff`、`cd web; npm test` 视项目 CI 而定）。,AUTOSERVER,Review 清理范围：只移除确定不可达/无引用代码；更新文档与代码一致；避免引入破坏性重构（KISS）。,回归：启动服务与前端构建无报错；grep 确认不存在对已删除文件/路由的引用；部署后路由表不包含遗留端点。,未开始,未开始,未开始,未提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:17;README.md:1;Report.md:1,
WCC-100,P1,10,both,发布灰度与回滚策略落地,按灰度策略先切前端到 chat-create 并观测，再决定是否下线旧端点；准备回滚开关与操作手册，保证出现问题可快速恢复。,1) 明确灰度阶段的观测项（日志/监控/错误率/创建耗时）与阈值；2) 提供可回滚方案（前端入口/后端开关/路由兼容）并有文档记录；3) 回归验证：灰度期间新旧链路均可用（按 Step1 决策）。,AUTOE2E,Review 风险控制：回滚步骤可执行且最小化；兼容期内不会造成数据不一致；监控埋点包含 workflow_id/run_id。,回归：模拟回滚操作并确认不影响既有 workflow 编辑/执行；观察指标在 1 个发布周期内稳定。,未开始,未开始,未开始,未提交,,plan/2025-12-31_12-15-24-workflow-chat-create-unification.md:20;README.md:1,
