"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"CFLOW-010","P0","1","both","固化回归基线与必跑命令清单","审计当前实现与测试覆盖，固化“完整真实测试”命令集合与当前基线结果，作为后续变更的对照与回归入口。","形成可复用的必跑命令清单（后端+前端+校验脚本）并记录当前通过/失败原因；可在本机按清单复现基线结果；不引入外网依赖到 deterministic 口径。","AUTOE2E","Review 变更前后基线差异记录是否完整；命令是否覆盖 scripts 校验/pytest/web type-check & test；确保记录不包含敏感信息。","后续每次合并前必须按清单跑完并附证据；任何失败必须区分“本次引入”与“既有失败”，并给出最小阻塞清单。","已完成","已完成","已完成","已提交","","docs/testing/WFCTRL-010_BASELINE.md:1;scripts/workflow_core_checks.ps1:1","picked_reason:P0 基线清单先固化，降低后续回归成本 | started_at:2026-01-10T23:29:39.6061265+08:00 | evidence:validate_node_definitions(exit0); validate_tool_configs(exit0); pytest_collect_only(exit0,7342); web_type_check(exit0); web_test(exit0,182 passed/4 skipped); workflow_core_checks(exit0) | known_failures:validate_prompt_templates(exit1 missing docs/prompt_templates); ruff_check(exit1 143 errors); web_lint(exit1 228 problems) | done_at:2026-01-10T23:35:05.1750075+08:00"
"CFLOW-020","P0","2","backend","条件分支 edge.condition 语义规范化（truth table）","定义并落地 edge.condition 的解释规则、fail-closed 行为、conditional 快捷分支兼容与多入边 OR join 语义边界。","满足计划文档 A 组验收：空条件通过；表达式 True/False 门控；异常 fail-closed 视为 False；支持 branch=true/false 与 result truthy/falsy 兼容；默认 OR join 且不引入隐式 AND。","AUTOSERVER","Review 语义是否与 Non-goals 对齐（不引入 goto/jump/cycle）；fail-closed 是否覆盖解析/类型异常；多入边语义是否明确且可解释。","新增/更新单元测试覆盖 A1-A4；对旧 workflow（无 condition）行为保持不变；提供至少 1 个反例证明异常不误执行。","已完成","已完成","已完成","已提交","","src/domain/services/workflow_engine.py:191;src/domain/services/workflow_engine.py:331;definitions/nodes/smart_order_processing_system.yaml:225;src/domain/services/workflow_engine.py:84;tests/unit/domain/services/test_workflow_engine_edge_condition_semantics.py:1","picked_reason:P0 先固化 edge.condition truth table 作为实现与测试基准 | started_at:2026-01-10T23:42:30.1115841+08:00 | evidence:pytest -q tests/unit/domain/services/test_workflow_engine_edge_condition_semantics.py (pass) | done_at:2026-01-10T23:47:38.4351237+08:00"
"CFLOW-030","P0","3","backend","引擎实现门控执行与 node_skipped 可观测性","在工作流执行引擎中基于 incoming edges + evaluator 判定是否执行节点，仅收集满足条件的 inputs，并产出 node_skipped 事件与原因。","满足 A 组验收并新增可观测性：被跳过节点产生 node_skipped 事件（含原因码/表达式/上游节点）；inputs 仅包含满足条件入边；解析失败不会导致节点执行（fail-closed）。","AUTOSERVER","Review 事件语义是否稳定（用于调试/回放）；确保不会破坏 DAG 无环约束；性能影响可控（表达式求值次数与缓存策略可解释）。","集成测试覆盖：条件分支只跑一边；多入边场景下 inputs 选择正确；事件流中包含 node_skipped。","已完成","已完成","已完成","已提交","","src/domain/services/workflow_engine.py:191;src/domain/services/workflow_engine.py:331;src/domain/services/workflow_engine.py:100;tests/unit/domain/services/test_workflow_executor.py:288","picked_reason:P0 门控执行与 node_skipped 事件用于可观测性与回归 | started_at:2026-01-10T23:48:21.1634021+08:00 | evidence:pytest -q tests/unit/domain/services/test_workflow_executor.py::TestWorkflowExecutor::test_execute_skips_node_when_edge_condition_is_invalid_fail_closed (pass); pytest -q tests/unit/domain/services/test_workflow_executor.py::TestWorkflowExecutor::test_execute_filters_inputs_after_conditional_branch (pass) | done_at:2026-01-10T23:50:49.1641841+08:00"
"CFLOW-040","P0","4","backend","对话增量编辑协议：nodes_to_update/edges_to_update + config_patch","让对话 agent 能用 update/patch 修改节点 config 与边 condition，避免必须 delete+add 才能改配置。","后端单测验证：1) nodes_to_update.config_patch 只覆盖指定字段且保留未提及字段；2) nodes_to_update.config 可整体替换（仅在明确需要时）；3) edges_to_update.condition 可更新/清空；4) 仍强制仅允许操作 start->end 主子图（越界返回结构化拒绝）。","AUTOSERVER","Review：限制可更新字段（name/position/config/condition），禁止通过 update 改 type；所有拒绝必须返回可机器解析的 errors 列表。","回归：用真实 chat 修改一次 http.url + edge.condition，并确保保存校验与执行均生效。","已完成","已完成","已完成","已提交","","src/domain/services/workflow_chat_service_enhanced.py:910;src/domain/services/workflow_chat_service_enhanced.py:760;tests/unit/domain/services/test_workflow_chat_service_enhanced_modifications.py:1;tests/integration/test_workflow_chat_incremental_update.py:1","picked_reason:P0 先补齐增量更新协议以支撑后续 config/condition 调整 | started_at:2026-01-10T23:51:34.7919066+08:00 | evidence:pytest -q tests/unit/domain/services/test_workflow_chat_service_enhanced_modifications.py (pass); pytest -q tests/integration/test_workflow_chat_incremental_update.py (pass) | done_at:2026-01-10T23:53:35.1583821+08:00"
"CFLOW-050","P0","5","backend","通用 node.config 模板化渲染（占位符替换）","支持在 http/file/db 等节点 config 中引用上游输出与 initial_input/context，稳定实现“动态拼 URL 再请求”。","实现并测试：1) 对 dict/list 递归渲染；2) string 占位符支持 `{input1.xxx}`、`{initial_input.xxx}`、`{context.xxx}`、数组下标（如 `{input1.items[0].id}`）；3) 路径不存在时保持原样（fail-soft）；4) 不执行表达式，仅做替换。集成用例验证：python/transform 产出 userId，httpRequest.url 使用占位符后真实发起请求（用 stub httpx）且 URL 被正确渲染。","AUTOSERVER","Review：模板渲染必须发生在 executor 之前；不允许引入任意代码执行；日志需可定位未解析占位符（至少 debug/warn）。","回归：覆盖 http headers/body、file.path/content、db.sql/params 的渲染场景，并确认不会破坏已有节点默认行为。","已完成","已完成","已完成","已提交","","src/domain/services/workflow_engine.py:331;src/infrastructure/executors/http_executor.py:1;src/infrastructure/executors/file_executor.py:1;src/infrastructure/executors/database_executor.py:1;src/domain/services/workflow_engine.py:350;tests/unit/domain/services/test_workflow_engine_templating.py:1;tests/integration/test_workflow_engine_templating_http_stub.py:1","picked_reason:P0 模板化渲染解锁动态 URL/headers/sql 等稳定数据流 | started_at:2026-01-10T23:54:04.9706835+08:00 | evidence:pytest -q tests/unit/domain/services/test_workflow_engine_templating.py (pass); pytest -q tests/integration/test_workflow_engine_templating_http_stub.py (pass) | done_at:2026-01-10T23:55:21.3107767+08:00"
"CFLOW-060","P1","6","both","定义三类真实场景用例（A/B/C）并固化为可回归断言","把“动态 URL→HTTP”“条件分支只跑一边”“对话 update 改配置”三类场景做成可重复的集成用例与演示路径。","新增/更新 integration 测试：A) 变量渲染后 HTTP 请求命中预期 URL；B) true/false 分支仅执行一边且另一边 node_skipped；C) chat update 修改 config/condition 后执行结果发生变化且保存校验通过。测试需可在 CI/本机稳定复跑（无网络依赖，均用 stub）。","AUTOE2E","Review：用例必须“可复现+无外部依赖”；断言要覆盖执行日志、跳过语义、以及渲染后的关键字段。","回归：同一套用例在重跑时输出一致（确定性）；异常分支（表达式错误、占位符缺失）也有覆盖。","已完成","已完成","已完成","已提交","","src/domain/services/workflow_engine.py:191;src/domain/services/workflow_chat_service_enhanced.py:910;tests/integration/test_workflow_engine_templating_http_stub.py:1;tests/integration/test_workflow_condition_gating.py:1;tests/integration/test_workflow_chat_update_changes_execution.py:1","picked_reason:P1 用例 A/B/C 固化为回归断言，避免后续语义回退 | started_at:2026-01-10T23:55:53.2023803+08:00 | evidence:pytest -q tests/integration/test_workflow_engine_templating_http_stub.py (pass); pytest -q tests/integration/test_workflow_condition_gating.py (pass); pytest -q tests/integration/test_workflow_chat_update_changes_execution.py (pass) | done_at:2026-01-10T23:57:08.7287860+08:00"
"CFLOW-070","P0","7.1","backend","补齐后端测试矩阵（unit+integration，stub 外部依赖）","为 edge.condition 门控、node_skipped、chat update、config 模板渲染补齐最小且可复跑的后端测试矩阵，并对外部依赖使用 stub。","新增/更新 unit+integration：覆盖 A 组语义（A1-A4）、模板渲染（嵌套路径/数组/缺失占位符 fail-soft）、chat update 应用（config_patch/condition 更新与越界拒绝）；集成测试对外部 HTTP/LLM 使用 stub（无网络依赖），并能在本机重复执行得到一致断言。","AUTOSERVER","Review：测试应聚焦边界与回归点；禁止引入真实外部调用；失败信息需可定位（包含 node_id/edge_id/表达式/占位符）。","回归：按测试矩阵复跑并确认失败闭环（区分新增回归 vs 既有失败）。","已完成","已完成","已完成","已提交","","tests:1;src/domain/services/workflow_engine.py:1;tests/unit/domain/services/test_workflow_engine_edge_condition_semantics.py:1;tests/unit/domain/services/test_workflow_engine_templating.py:1;tests/unit/domain/services/test_workflow_chat_service_enhanced_modifications.py:1;tests/unit/domain/services/test_workflow_executor.py:1;tests/integration/test_workflow_engine_templating_http_stub.py:1;tests/integration/test_workflow_condition_gating.py:1;tests/integration/test_workflow_chat_update_changes_execution.py:1","picked_reason:P0 先补齐/收敛后端测试矩阵，作为后续前端与全量回归基线 | started_at:2026-01-10T23:57:37.8682317+08:00 | evidence:pytest -q <matrix> (pass, 25 tests) | done_at:2026-01-10T23:58:23.8296876+08:00"
"CFLOW-080","P1","7.2","frontend","前端支持编辑/保存/回显 edge.condition 并补齐前端测试","在前端 workflow editor 中支持 edge.condition 的编辑、保存与回显，并补齐对应前端测试。","UI 可编辑 edge.condition（新增/清空均可）；保存后重新进入编辑页能正确回显；与后端数据格式一致（WorkflowEdge.condition 字段）；相关前端测试补齐并通过（type-check + unit）。","AUTOFRONTEND","Review：数据模型不破坏向后兼容（condition 可选）；避免 UI 与后端字段名漂移；测试覆盖保存与回显。","回归：重复编辑/保存/刷新/回显流程至少 1 次，且不影响既有节点编辑能力。","已完成","已完成","已完成","已提交","","web/src/features/workflows/types/workflow.ts:1;web/src/features/workflows/pages/WorkflowEditorPageWithMutex.tsx:840;web/src/features/workflows/pages/__tests__/WorkflowEditorEdgeConditionSave.test.tsx:1","picked_reason:P1 前端补齐 edge.condition 编辑/回显，打通端到端可用性 | started_at:2026-01-10T23:58:51.7028803+08:00 | evidence:pnpm -C web type-check (pass); pnpm -C web test (pass) | done_at:2026-01-11T00:10:21.8195973+08:00"
"CFLOW-090","P0","8","both","跑通完整真实测试清单并形成失败闭环证据","按口径跑通后端/前端/校验脚本；若发现既有不相关失败，必须分流并形成阻塞清单。","执行并记录：`python scripts/validate_node_definitions.py --strict`、`pnpm -C web type-check`、`pnpm -C web test` 均为退出码 0；后端至少完成与本需求相关的 unit+integration 全通过。若 `pytest -q` 不能全量通过，必须输出“既有失败列表 + 与本需求无关的证据”，并给出是否需要单独修复的建议。","AUTOE2E","Review：测试失败必须归因；只修复本次改动引入的回归；不得顺手重构引入额外风险。","回归：重复跑一遍口径清单；关键场景 A/B/C 需再次执行确认无漂移。","已完成","已完成","已完成","已提交","","scripts/validate_node_definitions.py:1;web/package.json:1;docs/testing/WFCTRL-010_BASELINE.md:1;src/domain/services/workflow_engine.py:120","picked_reason:P0 收敛“完整真实测试”闭环证据，作为最终发布闸门 | started_at:2026-01-11T00:11:02.9061973+08:00 | evidence:python scripts/validate_node_definitions.py --strict (exit0); pnpm -C web type-check (pass); pnpm -C web test (pass); pytest -q (pass, 7112 passed) | done_at:2026-01-11T00:21:36.7703874+08:00"
"CFLOW-100","P1","9","both","红队复审与受保护文档同步（语义/运维/安全）","从安全/可维护性角度复审条件表达式与模板渲染的边界，并同步更新相关受保护文档。","完成复审清单：1) 条件表达式必须 safe evaluator + fail-closed；2) 模板渲染仅替换不执行；3) chat update 不可越界主子图；4) 如涉及运行语义/协作链路变化，同步更新受保护文档并确保与实现一致。","AUTOE2E","Review：检查潜在注入点（SQL/headers/url）；必要时增加保存期校验/提示，降低运行期故障。","回归：进行一次“坏输入”注入测试（表达式非法、占位符缺失），确认系统 fail-safe。","已完成","已完成","已完成","已提交","","docs/architecture/current_agents.md:1;docs/operations/operations_guide.md:1;src/domain/services/expression_evaluator.py:1;src/domain/services/workflow_engine.py:90;src/domain/services/execution_monitor.py:470;docs/architecture/MONITORING_ARCHITECTURE.md:232;tests/unit/domain/services/test_workflow_executor.py:288;tests/unit/domain/services/test_workflow_engine_templating.py:1;tests/unit/domain/services/test_execution_monitor.py:1","picked_reason:P1 红队复审 + 受保护文档同步，确保语义/运维/安全不漂移 | started_at:2026-01-11T00:23:56.3296847+08:00 | evidence:pytest -q tests/unit/domain/services/test_workflow_executor.py::TestWorkflowExecutor::test_execute_skips_node_when_edge_condition_is_invalid_fail_closed tests/unit/domain/services/test_workflow_engine_templating.py (pass); pytest -q tests/unit/domain/services/test_execution_monitor.py (pass); docs/architecture/MONITORING_ARCHITECTURE.md 同步 node_skipped 语义 | done_at:2026-01-11T00:27:50.2393717+08:00"
