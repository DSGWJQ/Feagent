# 工作流编辑器手动测试指南

## 已修复的问题

1. ✅ **布局问题** - 修复了按钮被遮盖的问题，使用固定定位和正确的 z-index
2. ✅ **导入错误** - 修复了 `@xyflow/react` 的 Node 类型导入
3. ✅ **测试数据** - 创建了 ID=1 的测试工作流

## 测试前准备

### 1. 启动后端
```bash
# 在项目根目录
python -m uvicorn src.interfaces.api.main:app --reload
```
后端运行在：`http://localhost:8000`

### 2. 启动前端
```bash
# 打开新终端
cd web
npm run dev
```
前端运行在：`http://localhost:3000`

### 3. 访问页面
浏览器打开：`http://localhost:3000/workflows/1/edit`

**重要：必须是 3000 端口，不是 8000！**

---

## 测试步骤

### 测试 1：查看初始工作流

**预期结果：**
- 看到画布上有 3 个节点（开始 → 获取数据 → 结束）
- 节点之间有连线
- 左侧有节点调色板
- 顶部有工具栏（导出代码、保存、执行按钮）

**如果看不到按钮：**
- 刷新页面（Ctrl+F5）
- 检查浏览器控制台是否有错误

---

### 测试 2：拖拽添加节点

**步骤：**
1. 从左侧调色板选择一个节点（如 "HTTP Request"）
2. 按住鼠标左键拖拽到画布
3. 松开鼠标

**预期结果：**
- 新节点出现在画布上
- 节点有输入和输出连接点（小圆点）

**如果节点没有连接点：**
- 检查浏览器控制台错误
- 确认节点类型是否正确注册

---

### 测试 3：点击添加节点

**步骤：**
1. 点击左侧调色板的节点（不拖拽）
2. 节点会自动添加到画布中心

**预期结果：**
- 节点出现在画布中心
- 可以拖动节点位置

---

### 测试 4：连接节点

**步骤：**
1. 将鼠标移到节点右侧的输出点（小圆点）
2. 按住鼠标左键拖拽到另一个节点的输入点
3. 松开鼠标

**预期结果：**
- 两个节点之间出现连线
- 连线是箭头形状

**如果不能连接：**
- 确认节点有 Handle（输入/输出点）
- 检查是否从输出点拖到输入点（不能反向）
- 查看浏览器控制台错误

---

### 测试 5：配置节点

**步骤：**
1. 点击画布上的任意节点
2. 右侧抽屉打开，显示节点配置
3. 修改配置（如 HTTP 节点的 URL）
4. 点击「保存」按钮

**预期结果：**
- 抽屉正确打开
- 显示该节点类型的配置表单
- 保存后抽屉关闭

**配置项示例：**
- **HTTP Request**: URL、Method、Headers、Body
- **Text Model**: Model、Temperature、Max Tokens
- **Conditional**: Condition 表达式
- **Prompt**: Content 文本

---

### 测试 6：保存工作流

**步骤：**
1. 修改工作流（添加/删除节点、修改连线）
2. 点击顶部「保存」按钮

**预期结果：**
- 显示「工作流保存成功」提示
- 刷新页面后修改仍然存在

**如果保存失败：**
- 检查后端是否运行
- 查看浏览器 Network 标签的请求
- 查看后端日志

---

### 测试 7：执行工作流

**步骤：**
1. 确保工作流有完整的路径（开始 → 中间节点 → 结束）
2. 点击顶部「执行」按钮
3. 观察节点状态变化

**预期结果：**
- 节点依次变色：
  - **黄色边框** = 正在执行
  - **绿色边框** = 执行成功
  - **红色边框** = 执行失败
- 右侧出现执行日志面板
- 显示每个节点的输出结果

**如果执行失败：**
- 查看右侧执行日志的错误信息
- 检查节点配置是否正确（如 HTTP URL 是否有效）
- 查看后端日志

**测试用例：**

#### 用例 1：简单 HTTP 请求
1. 创建：开始 → HTTP Request → 结束
2. 配置 HTTP 节点：
   - URL: `https://jsonplaceholder.typicode.com/posts/1`
   - Method: `GET`
3. 执行
4. 预期：成功返回 JSON 数据

#### 用例 2：条件分支
1. 创建：开始 → Prompt → Conditional → 结束
2. 配置 Prompt 节点：
   - Content: `test`
3. 配置 Conditional 节点：
   - Condition: `'test' in str(input1)`
4. 执行
5. 预期：条件为 True

---

### 测试 8：代码导出

**步骤：**
1. 点击顶部「导出代码」按钮
2. 选择语言（Python 或 TypeScript）
3. 查看生成的代码
4. 点击「复制」或「下载」

**预期结果：**
- 对话框打开
- 显示可执行的代码
- 代码包含所有节点的逻辑
- 可以复制到剪贴板
- 可以下载为文件

---

## 常见问题排查

### 问题 1：页面空白

**检查：**
1. 打开浏览器控制台（F12）
2. 查看 Console 标签的错误
3. 查看 Network 标签的请求

**可能原因：**
- 前端未启动或端口错误
- 访问了错误的 URL（应该是 localhost:3000）
- JavaScript 错误

### 问题 2：按钮被遮盖

**解决：**
- 已修复，刷新页面（Ctrl+F5）
- 如果仍有问题，检查浏览器缩放比例（应该是 100%）

### 问题 3：节点不能连接

**检查：**
1. 节点是否有输入/输出点（小圆点）
2. 是否从输出点拖到输入点
3. 浏览器控制台是否有错误

**调试：**
- 打开 React DevTools
- 检查节点组件是否有 `<Handle>` 元素

### 问题 4：执行返回"workflow 不存在"

**检查：**
1. 后端日志是否显示 200 OK
2. 如果后端成功，可能是前端显示了旧错误
3. 刷新页面重新执行

**验证后端：**
```bash
# 测试后端 API
curl http://localhost:8000/api/workflows/1
```

### 问题 5：API 调用失败

**检查：**
1. 后端是否运行：`http://localhost:8000/health`
2. 前端代理配置：`web/vite.config.ts`
3. CORS 配置：`src/interfaces/api/main.py`

---

## 测试检查清单

- [ ] 页面正常加载，看到工具栏和画布
- [ ] 左侧节点调色板显示 12 种节点
- [ ] 可以拖拽添加节点
- [ ] 可以点击添加节点
- [ ] 节点有输入/输出连接点
- [ ] 可以连接节点
- [ ] 点击节点打开配置面板
- [ ] 可以修改节点配置
- [ ] 可以保存工作流
- [ ] 可以执行工作流
- [ ] 节点状态正确显示（黄→绿）
- [ ] 执行日志正确显示
- [ ] 可以导出代码（Python/TypeScript）
- [ ] 代码可以复制和下载

---

## 下一步

测试完成后，可以：

1. **创建更复杂的工作流**
   - 多个 HTTP 请求串联
   - 使用条件分支
   - 使用 LLM 节点（需要配置 API Key）

2. **测试错误处理**
   - 使用无效的 URL
   - 使用错误的条件表达式
   - 断开节点连接

3. **性能测试**
   - 创建大量节点（50+）
   - 执行长时间运行的工作流
   - 测试并发执行

4. **集成测试**
   - 测试保存后刷新
   - 测试多个浏览器标签
   - 测试后端重启后的恢复

---

## 报告问题

如果发现问题，请提供：

1. **问题描述**：具体现象
2. **复现步骤**：如何触发问题
3. **浏览器控制台**：Console 和 Network 截图
4. **后端日志**：相关的错误日志
5. **环境信息**：浏览器版本、操作系统

---

**祝测试顺利！** 🎉

